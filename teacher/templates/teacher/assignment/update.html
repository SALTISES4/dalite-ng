{% extends 'teacher/base.html' %}

{% load bleach_html static %}

{% block apps %}
  {{ block.super }}
  <script
    src="{% static 'components/js/build/updateAssignment.min.js' %}"
    defer="true"
  ></script>

  <style nonce="{{ request.csp_nonce }}">
    {% include 'teacher/assignment/html_editor_styles.html' %}
  </style>
{% endblock %}

{% block injected_apps %}
  {{ block.super }}
  <div id="assignment-update-app"></div>
{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script nonce="{{ request.csp_nonce }}">
    window.addEventListener("load", function () {
      const assignmentUpdateApp = () => {
        return updateAssignment.h(updateAssignment.App, {
          gettext: gettext,
          nonce: "{{ request.csp_nonce }}",
          assignment: {
            conclusion_page: {% spaceless %}"{{ object.conclusion_page|default_if_none:''|bleach_html|safe }}"{% endspaceless %},
            description: {% spaceless %}"{{ object.description|default_if_none:''|bleach_html|safe }}"{% endspaceless %},
            intro_page: {% spaceless %}"{{ object.intro_page|default_if_none:''|bleach_html|safe }}"{% endspaceless %},
            owner: {{ owner|safe }},
            pk: "{{ object.identifier }}",
            title: "{{ object.title|bleach_html|safe }}",
          },
          EditorIcons: {
            boldIcon: "{% static 'components/img/editor/bold.svg' %}",
            italicIcon: "{% static 'components/img/editor/italic.svg' %}",
            underIcon: "{% static 'components/img/editor/under.svg' %}",
            undoIcon: "{% static 'components/img/editor/undo.svg' %}",
            redoIcon: "{% static 'components/img/editor/redo.svg' %}",
            subIcon: "{% static 'components/img/editor/sub.svg' %}",
            superIcon: "{% static 'components/img/editor/super.svg' %}",
            linkIcon: "{% static 'components/img/editor/link.svg' %}",
          },
          lti: {
            launchURL: "{{ LTI_launch_url }}",
            consumerKey: "{{ LTI_key }}",
            sharedSecret: "{{ LTI_secret }}",
            teacherHash: "{{ request.user.teacher.hash }}",
          },
          metaEditableByUser: {{ meta_editable_by_user|yesno:"true,false" }},
          questionsEditableByUser: {{ questions_editable_by_user|yesno:"true,false" }},
          urls: {
            add_to_assignment: "{% url 'REST:assignment_question-list' %}",
            assignment: {% if meta_editable_by_user or questions_editable_by_user %}"{% url 'REST:teacher-assignment-detail' object.identifier %}?field=questions&field=is_valid&field=intro_page&field=conclusion_page&field=description&field=title&field=pk"{% else %}"{% url 'REST:assignment-detail' object.identifier %}?field=questions&field=is_valid&field=intro_page&field=conclusion_page&field=description&field=title&field=pk"{% endif %},
            distribute: "{% url 'REST:studentgroupassignment-list' %}",
            remove_question: "{% url 'REST:assignment_question-detail' object.pk %}",
            studentgroupassignments: "{% url 'REST:studentgroupassignment-for-assignment' object.pk %}?field=group&field=due_date&field=progress&field=title",
            teacher: "{% url 'REST:teacher' request.user.teacher.pk %}?field=favourite_questions&field=assignable_groups",
          },
        });
      };
      updateAssignment.render(
        assignmentUpdateApp(),
        document.getElementById("assignment-update-app")
      );
    });
  </script>
{% endblock %}

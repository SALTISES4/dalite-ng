!function(e){"use strict";function t(){return document.getElementsByName("csrfmiddlewaretoken")[0].getAttribute("value")}function n(e,n){if("get"===n.toLowerCase())return{method:n.toUpperCase(),headers:{"Content-Type":"application/json","X-CSRFToken":t()}};if("post"===n.toLowerCase()){const i=e?JSON.stringify(e):"";return{method:n.toUpperCase(),body:i,headers:{"Content-Type":"application/json","X-CSRFToken":t()}}}throw Error("Method ".concat(n," not implemented yet."))}function i(e){for(;e.hasChildNodes();)e.removeChild(e.lastChild);return e}let o;function a(e,t,i){const a=t.getAttribute("data-type"),r=t.getAttribute("name");let l;if("CommaSepField"===a||"ManyToManyField"===a)if(t.querySelector(".comma-sep-input--input").setCustomValidity(""),"Enter"===e.key||","===e.key||" "===e.key){if(" "!==l&&","!==l||(l=""),l=t.querySelector(".comma-sep-input--input").value,!l)return void e.preventDefault();if(i[r].allowed&&!i[r].allowed.includes(l))return s(t.querySelector(".comma-sep-input--input"),"".concat(l," isn't an accepted language. Options are ").concat(i[r].allowed.slice(0,i[r].allowed.length-1).join(", ")," and ").concat(i[r].allowed[i[r].allowed.length-1],".")),t.querySelector(".comma-sep-input--input").value="",void e.preventDefault()}else{if("Backspace"!==e.key)return;if(l=t.querySelector(".comma-sep-input--input").value,l)return}else if("PositiveIntegerField"===a||"ProbabilityField"===a||"FloatField"===a||"IntegerField"===a){if(t.setCustomValidity(""),l=t.value,""===l){if("insertText"!==e.inputType||"-"!==e.data)return;l=0,t.value=0}if("ProbabilityField"===a)if(l<0)l=0,t.value=l;else if(l>1)l=parseFloat("0."+l),t.value=l;else{if(l.toString().length>4)return void(t.value=o.criterions.filter(e=>e.name===i.name)[0][r].value);if(o.criterions.filter(e=>e.name===i.name)[0][r].value==l)return void("00"===l&&(t.value="0"))}}else"BooleanField"===a?(t.setCustomValidity(""),l="false"===t.value):(t.setCustomValidity(""),l=t.value);const d=n({quality:o.quality.pk,criterion:i.name,field:r,value:l},"post");fetch(o.urls.updateCriterion,d).then(e=>e.ok?e.json():e.text()).then(e=>{"string"==typeof e?s(err):(o.criterions=o.criterions.map(t=>t.name===e.name?e:t),c(a,"weight"===r?e.weight:e[r].value,i,t))}).catch(e=>console.log(e))}function r(){!function(){const e=document.querySelector("#back-link");o.next?(e.href=o.next,"teacher"===o.quality.qualityType?e.textContent="Back to account":e.textContent="Back to ".concat(o.quality.qualityType)):e.parentNode.removeChild(e)}(),l(),d()}function l(){const e=document.querySelector("#criterions");i(e),o.criterions.forEach(t=>{e.appendChild(function(e){const t=document.createElement("div");t.classList.add("criterion"),t.classList.add("criterion__showing"),t.name=e.name;const i=document.createElement("div");i.classList.add("criterion--name"),i.textContent=e.full_name,i.title=e.description,i.addEventListener("click",()=>function(e){e.classList.contains("criterion__showing")?e.classList.remove("criterion__showing"):e.classList.add("criterion__showing")}(t)),t.appendChild(i);const a=document.createElement("button");a.classList.add("criterion--remove"),a.addEventListener("click",t=>{!function(e){const t=n({quality:o.quality.pk,criterion:e.name},"post");fetch(o.urls.removeCriterion,t).then(t=>{t.ok&&(o.criterions=o.criterions.filter(t=>t.name!=e.name),l(),d())}).catch(e=>console.log(e))}(e),t.stopPropagation()}),i.appendChild(a);const r=document.createElement("i");r.classList.add("material-icons"),r.textContent="close",a.appendChild(r);const s=document.createElement("div");s.classList.add("criterion--options"),t.appendChild(s);const u=e.versions[e.version-1].binary_threshold,p=document.createElement("label");p.textContent="Weight:";const m=c("PositiveIntegerField",e.weight,e);m.name="weight",s.appendChild(p),s.appendChild(m);return Object.keys(e).filter(e=>!["description","full_name","is_beta","name","version","versions","weight"].includes(e)).forEach(t=>{if(!u||"threshold"!==t){const n=e[t],i=document.createElement("label");i.textContent="".concat(n.full_name,":"),i.title=n.description;const o=c(n.type,n.value,e,null);o.setAttribute("name",n.name),s.appendChild(i),s.appendChild(o)}}),t}(t))})}function c(e,t,n,o=null){const r=!!o;if("PositiveIntegerField"===e)return o||((o=document.createElement("input")).setAttribute("data-type",e),o.type="number",o.min=0,o.addEventListener("input",e=>a(e,o,n))),o.value=t,o;if("ProbabilityField"===e)return o||((o=document.createElement("input")).setAttribute("data-type",e),o.type="number",o.min=0,o.max=1,o.step=.01,o.addEventListener("input",e=>a(e,o,n)),r&&o.focus()),o.value=t,o;if("CommaSepField"===e||"ManyToManyField"===e){o||((o=document.createElement("div")).setAttribute("data-type",e),o.classList.add("comma-sep-input"),o.type="comma-sep"),i(o),t.forEach(e=>{const t=document.createElement("span");t.classList.add("comma-sep-input--word"),t.textContent=e,o.appendChild(t)});const l=document.createElement("input");return l.classList.add("comma-sep-input--input"),l.type="text",l.addEventListener("keydown",e=>a(e,o,n)),o.appendChild(l),r&&l.focus(),o}if("BooleanField"===e){if(!o){(o=document.createElement("div")).setAttribute("data-type",e),o.classList.add("boolean-input"),i(o);const t=document.createElement("input");t.classList.add("boolean-input--input"),t.type="checkbox",t.addEventListener("click",e=>a(e,o,n)),o.appendChild(t);const l=document.createElement("span");l.classList.add("boolean-input--background"),o.appendChild(l);const c=document.createElement("span");c.classList.add("boolean-input--mark"),o.appendChild(c),r&&t.focus()}return o.value=t,o}}function s(e,t){e.setCustomValidity(t)}function d(){const e=document.querySelector(".add-criterion button"),t=o.available.filter(e=>!o.criterions.map(e=>e.name).includes(e.name));if(t.length){const a=document.querySelector(".available-criterions ul");i(a),t.forEach(e=>{a.appendChild(function(e){const t=document.createElement("li");return t.title=e.description,t.textContent=e.fullName,t.addEventListener("click",()=>function(e){const t=n({quality:o.quality.pk,criterion:e.name},"post");fetch(o.urls.addCriterion,t).then(e=>e.json()).then(e=>{o.criterions.push(e),l(),d(),u()}).catch(e=>console.log(e))}(e)),t}(e))}),e.disabled=!1,e.title="Add a new criterion"}else e.disabled=!0,e.title="There are no new criterions to add"}function u(){const e=document.querySelector(".add-criterion");e.classList.contains("add-criterion__showing")?e.classList.remove("add-criterion__showing"):o.available.length&&e.classList.add("add-criterion__showing")}function p(){document.querySelector(".add-criterion button").addEventListener("click",u)}e.init=function(e){!function(e){o={quality:{pk:e.quality.pk,qualityType:e.quality.quality_type},next:e.next,available:e.available.map(e=>({name:e.name,fullName:e.full_name,description:e.description})),criterions:e.criterions,urls:{addCriterion:e.urls.add_criterion,updateCriterion:e.urls.update_criterion,removeCriterion:e.urls.remove_criterion}}}(e),r(),p()}}(this.edit=this.edit||{});
//# sourceMappingURL=edit.min.js.map

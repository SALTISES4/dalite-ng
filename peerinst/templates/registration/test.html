{% extends "peerinst/base.html" %}

{% block stylesheets %}
<style>
.stats {
  display:block;
  margin:auto;
}
.mdc-toolbar--flexible {
  --mdc-toolbar-ratio-to-extend-flexible:10;
}
.mdc-toolbar {
  padding-left:0pt;
}
.mdc-typography--caption {
   text-align:center;
}
.mdc-typography--display3 {
  /*position:sticky;
  top:80px;*/
}
.embedded-video {
  display:block;
  margin:auto;
}
.white {
  background-color: white;
}
#animation {
  display:block;
  margin:auto;
  overflow:visible;
}
</style>
{% endblock %}

{% block body %}
<header class="mdc-toolbar mdc-toolbar--fixed mdc-toolbar--flexible mdc-toolbar--waterfall">
  <div class="mdc-toolbar__row">
    <svg id="animation" width=800 height=80></svg>
  </div>
</header>

<main class="mdc-toolbar-fixed-adjust">
  <section>
    <h1 class="mdc-typography--display3 mdc-theme--background">Introduction</h1>
    <h2 class="mdc-typography--headline">Paragraph title</h2>
    <p class="mdc-typography--body1">
      {% lorem %}
    </p>
    <h2 class="mdc-typography--headline">Paragraph title</h2>
    <p class="mdc-typography--body1">
      {% lorem %}
    </p>
  </section>

  <section>
    <h1 class="mdc-typography--display3 mdc-theme--background">Features</h1>
    <h2 class="mdc-typography--headline">Paragraph title</h2>
    <p class="mdc-typography--body1">
      {% lorem %}
    </p>
    <h2 class="mdc-typography--headline">Most active disciplines</h2>
    <div class="mdc-chip-set mdc-chip-set--filter">
      {% for d in disciplines %}
      <div class="mdc-chip">
        <div class="mdc-chip__checkmark" >
          <svg class="mdc-chip__checkmark-svg" viewBox="-2 -3 30 30">
            <path class="mdc-chip__checkmark-path" fill="none" stroke="black"
                  d="M1.73,12.91 8.1,19.28 22.79,4.59"/>
          </svg>
        </div>
        <div class="mdc-chip__text">{{ d }}</div>
      </div>
      {% endfor %}
    </div>

    <div class="mdc-layout-grid">
      <div class="mdc-layout-grid__inner">
        {% for l in disciplines.All %}
          <div class="mdc-layout-grid__cell--span-3">
            <svg class="stats" id="{{ l }}" width=100 height=100></svg>
            <div class="mdc-typography--caption">{{ l|capfirst }}</div>
          </div>
        {% endfor %}
      </div>
    </div>
  </section>

  <section>
    <h1 class="mdc-typography--display3 mdc-theme--background">Take a guided tour</h1>
    <!-- Faster load time??: https://developers.google.com/youtube/iframe_api_reference#Loading_a_Video_Player -->
    <div>
      <iframe class="embedded-video" width="560" height="315" src="https://www.youtube.com/embed/uW2r0jGNp8I?rel=0&amp;showinfo=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>
  </section>

  <section>
    <h1 class="mdc-typography--display3 mdc-theme--background">SALTISE/S4</h1>
    <h2 class="mdc-typography--headline">Vision</h2>
    <p class="mdc-typography--body1">
      SALTISE is a learning community that fosters the development and research of tools and resources for pedagogical innovations as well as bringing together educators (researchers and practitioners) and professional development personnel across the province of Quebec, as well as welcoming national and international partnerships.
    </p>
    <h2 class="mdc-typography--headline">The S4 project</h2>
    <p class="mdc-typography--body1">
      {% lorem %}
    </p>
  </section>

  <section>
    <h1 class="mdc-typography--display3 mdc-theme--background">Partners</h1>
    <h2 class="mdc-typography--headline">Paragraph title</h2>
    <p class="mdc-typography--body1">
      {% lorem %}
    </p>
    <ul class="mdc-image-list mdc-image-list--masonry partner-list">
      <li class="mdc-image-list__item">
        <img class="mdc-image-list__image" src="...">
      </li>
    </ul>
  </section>
</main>

<script>
  var chipset = mdc.chips.MDCChipSet.attachTo(document.querySelector('.mdc-chip-set'));

  var toolbar = mdc.toolbar.MDCToolbar.attachTo(document.querySelector('.mdc-toolbar'));
  toolbar.fixedAdjustElement = document.querySelector('.mdc-toolbar-fixed-adjust');

  var flexibleExpansionRatio = 1.0;
  toolbar.listen('MDCToolbar:change', function(evt) {
    flexibleExpansionRatio = evt.detail.flexibleExpansionRatio;
  });
</script>

<script>
function logo(){
var svg = d3.select("#animation");
svg.attr("width",document.body.offsetWidth);

var width = +svg.attr("width"),
height = +svg.attr("height"),
margin = {top:1,bottom:1,left:1,right:1};

var innerWidth = width-margin.left-margin.right,
innerHeight = height-margin.top-margin.bottom;

svg.selectAll("g").remove();

var g = svg.append("g").attr("transform","translate("+margin.left+","+(margin.top+innerHeight/2)+")");

var x = d3.scaleLinear().domain([0,2*Math.PI]).range([0,innerWidth]),
y = d3.scaleLinear().domain([-1,1]).range([-innerHeight/2,innerHeight/2]);

var xAxis = g.append("g").style("opacity",0).call(d3.axisBottom(x)),
yAxis = g.append("g").style("opacity",0).call(d3.axisLeft(y));

var xPoints = d3.range(0,2*Math.PI+0.01,(2*Math.PI/20));

function f(v,x,t,a) {
  return Math.min(Math.max(10*flexibleExpansionRatio,2),4)*a*Math.sin(x-0.5*v*(t-dt));
}

var dt = 0;
var t = d3.now();

var a1 = 0.5;
var a2 = 0.3;
var a3 = 0.4;

var v1 = 0.001;
var v2 = 0.0018;
var v3 = -0.001;

var y1 = 0;
var y2 = -0.1;
var y3 = +0.05;

var line1 = d3.line()
    .x(function(d) { return x(d); })
    .y(function(d) { return y(f(v1,d,d3.now(),a1)+y1); })
    .curve(d3.curveNatural);

var line2 = d3.line()
    .x(function(d) { return x(d); })
    .y(function(d) { return y(f(v2,d,d3.now(),a2)+y2); })
    .curve(d3.curveNatural);

var line3 = d3.line()
    .x(function(d) { return x(d); })
    .y(function(d) { return y(f(v3,d,d3.now(),a3)+y3); })
    .curve(d3.curveNatural);

var intersection1 = d3.area()
    .x(line1.x())
    .y0(y(0))
    .y1(line1.y())
    .curve(d3.curveNatural);

var intersection2 = d3.area()
    .x0(line1.x())
    .y0(line1.y())
    .x1(line2.x())
    .y1(line2.y())
    .curve(d3.curveNatural);

var intersection3 = d3.area()
    .x0(line1.x())
    .y0(line1.y())
    .x1(line3.x())
    .y1(line3.y())
    .curve(d3.curveNatural);

g.append("path")
  .datum(xPoints)
  .attr("class","intersection")
  .attr("fill",d3.rgb(244,244,244,0.2))
  .attr("d",intersection1)
  .transition()
  .duration(50)
  .on("start", function repeat() {
        if (flexibleExpansionRatio>0.01) {
          t = d3.now();
          d3.active(this)
              .attr("d",intersection1)
            .transition()
              .on("start", repeat);
        }
        else {
          dt += d3.now() - t;
          t = d3.now();
          d3.active(this)
          .transition()
            .on("start", repeat);
        }
      });

g.append("path")
  .datum(xPoints)
  .attr("class","intersection")
  .attr("fill",d3.rgb(244,244,244,0.4))
  .attr("d",intersection2)
  .transition()
  .duration(50)
  .on("start", function repeat() {
        if (flexibleExpansionRatio>0.01) {
          d3.active(this)
              .attr("d",intersection2)
            .transition()
              .on("start", repeat);
        }
        else {
          d3.active(this)
          .transition()
            .on("start", repeat);
        }
      });

g.append("path")
  .datum(xPoints)
  .attr("class","intersection")
  .attr("fill",d3.rgb(0,66,102,0.4))
  .attr("d",intersection3)
  .transition()
  .duration(50)
  .on("start", function repeat() {
        if (flexibleExpansionRatio>0.01) {
          d3.active(this)
              .attr("d",intersection3)
            .transition()
              .on("start", repeat);
        }
        else {
          d3.active(this)
          .transition()
            .on("start", repeat);
        }
      });

g.append("text")
.attr("x",margin.left+innerWidth/2)
.attr("dx","25pt")
.attr("y",y(0))
.attr("fill","white")
.attr("text-anchor","middle")
.style("font-size","40pt")
.style("cursor","pointer")
.text("DALITE")
.on("click",function(){
  window.location="{% url 'login' %}"
});

g.append("text")
.attr("x",margin.left+innerWidth/2)
.attr("dx","-70pt")
.attr("y",y(0))
.attr("fill","white")
.attr("text-anchor","middle")
.style("font-family","Cardo, serif")
.style("font-style",'italic')
.style("font-size","40pt")
.style("cursor","pointer")
.text("my")
.on("click",function(){
  window.location="{% url 'login' %}"
});

g.append("text")
.attr("x",margin.left+innerWidth/2+175)
.attr("y",y(0))
.attr("dx",-110)
.attr("dy","16pt")
.attr("fill","white")
.attr("text-anchor","end")
.style("font-family","Cardo, serif")
.style("font-style",'italic')
.style("font-size","14pt")
.text("by")

g.append("text")
.attr("x",margin.left+innerWidth/2+145)
.attr("y",y(0))
.attr("dx","20pt")
.attr("dy","16pt")
.attr("fill","white")
.attr("text-anchor","end")
.style("font-size","14pt")
.text("SALTISE/S4");

}
logo();
window.addEventListener("resize",logo);

</script>


<script>
data = {{ json|safe }};
labels = d3.keys(data);
svg = [];
width = [];
height = [];
for (var i in labels){
  svg[i] =  d3.select("#"+labels[i]);
  width[i] = +svg[i].attr('width');
  height[i] = +svg[i].attr('height');

  var g = svg[i].append("g")
    .attr("transform","translate(" + width[i]/2 + "," + height[i]/2 + ")");

  g.append("text")
    .attr("class","count")
    .attr("x",0)
    .attr("y",0)
    .attr("dy",20)
    .style("font-size","40pt")
    .attr("text-anchor","middle")
    .text();
}

</script>
{% endblock %}

{% extends 'peerinst/base.html' %}

{% load staticfiles compress i18n %}

{% block stylesheets %}
<style>
  .sticky-header {
    position: -webkit-sticky;
    position: sticky;
    top: 0px;
  }
  .padded-bottom {
    margin-bottom: 20px;
  }
  td {
    border: 1px solid rgb(190,190,190);
    padding: 10px;
  }
</style>
{% endblock %}

{% block body %}
<main>
<section>

  <div class="sticky-header mdc-theme--background">
    <h2 class="mdc-typography--display1 mdc-theme--secondary">{% trans 'Question' %}: {{ question.title|safe }}</h2>


    <div class="admin-link">
      {% if discipline_title %}
          <a href="{% url 'research-discipline-question-index-by-discipline' discipline_title=discipline_title %}#{{ question.pk }}">{% trans 'Back to Question List' %}</a>
      {% elif assignment_id %}
          <a href="{% url 'research-assignment-question-index-by-assignment' assignment_id=assignment_id %}#{{ question.pk }}">{% trans 'Back to Question List' %}</a>
          <span style="padding-left:0.3em;padding-right:0.5em;">|</span><a href="{% url 'question-list' assignment_id=assignment_id %}">{% trans 'Back to Assignment' %}</a>
      {% endif %}
      <span style="padding-left:0.3em;padding-right:0.5em;">|</span> Number of rationales scored for this answer choice by {{ annotator }}: {{ annotations_count }}
      <i id="activate-dialog" class="material-icons md-24 mdc-ripple-surface icon-list">info</i>
        <aside id="dialog"
          class="mdc-dialog"
          role="alertdialog"
          aria-labelledby="assignment-parameters-label"
          aria-describedby="assignment-parameters-description">
          <div class="mdc-dialog__surface">
            <header class="mdc-dialog__header">
              <h2 id="assignment-parameters-label" class="mdc-dialog__header__title">
                {% trans 'Scoring Rationales' %}
              </h2>
            </header>
            <section id="assignment-parameters-description" class="mdc-dialog__body mdc-dialog__body--scrollable">
              <p class="mdc-typography--body1">{% blocktrans %}Please use the table below to score the rationales for this answer choice to this question.<br><br>
                These rationales will be shown to students (hover on the text to see how many times they have already been shown).<br><br>
                The goal here is to score based on how <em>convincing</em> the rationale is, <em>even if it is for the wrong answer!</em><br><br>
                As a subject matter expert, your scores will help determine what rationales get shown to future students.<br><br>
                Thank you for your contribution in helping maintain the database!<br><br>
                - The SALTISE/S4 Team{% endblocktrans %}</p>

            </section>
            <footer class="mdc-dialog__footer">
              <button type="button" class="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept">Ok</button>
            </footer>
          </div>
          <div class="mdc-dialog__backdrop"></div>
        </aside>

    </div>

    <input form="annotate-form" type="submit" class="mdc-button mdc-button--raised padded-bottom" value="Update Scores">

    <i class="mdc-icon-toggle material-icons mdc-theme--primary"
        role="button"
        title="{% trans 'Show/Hide' %}"
        aria-label="{% trans 'Show/Hide' %}" tabindex="0"
        aria-pressed="false"
        data-toggle-on='{"label": "{% trans 'Show' %}", "content": "unfold_more"}'
        data-toggle-off='{"label": "{% trans 'Hide' %}", "content": "unfold_less"}'
        onclick="$('.hidable').toggle();">
        unfold_less
    </i>

    <div class="mdc-card">
      <div class="mdc-typography--body1">
        {{question.text|safe}}
      </div>

      <div class="hidable">
        {% if question.image %}
        <img class="question-image" src="{{ question.image.url }}" height="{{ question.image.height }}"
             width="{{ question.image.width }}" alt="question.image_alt_text">
        {% endif %}
        {% if question.video_url %}
        <div id="question-video">
          <object class="question-image" width="640" height="390" data="{{ question.video_url }}"></object>
        </div>
        {% endif %}

        <ul id="answer-choices">
          {% for label, choice in question.get_choices %}
          <li class="dense-list">{{ label }}. {{ choice|safe }}</li>
          {% endfor %}
        </ul>

        <div class="question-answers">
          Correct answer(s):
          {% for label, choice in question.get_choices %}
            {% for c in question.answerchoice_set.all %}
              {% if forloop.counter == forloop.parentloop.counter %}
                {% if c.correct %}
                  <blockquote><strong>{{ label }}. {{ choice|safe }}</strong></blockquote>
                {% endif %}
              {% endif %}
            {% endfor %}
          {% endfor %}
        </div>

      </div>
  </div>

</div>

<div class="content">
  <form action="" method="post" id="annotate-form">
  {% csrf_token %}

  {{ formset.management_form }}

<table>
<thead>
  <tr>
    <td>Answer</td>
    <td>Score</td>
    <td>Rationale</td>
  </tr>
</thead>
<tbody>

  {% for form in formset %}
  {{ form.id }}
    <tr>
      <td>{{ form.instance.answer.first_answer_choice_label }}</td>
      <td>{{ form.score }}</td>
      <td title="id:{{ form.instance.answer.pk }};  times shown: {{ form.instance.times_shown }} ">{{ form.instance.answer.rationale }}</td>
    </tr>
  {% endfor %}
</tbody>
</table>
</form>
</div>

</section>
</main>

{% endblock %}

{% block scripts %}
<script>
  $(".mdc-icon-toggle").each(function() {
      bundle.iconToggle.MDCIconToggle.attachTo(this);
  });
  bundle.addDialog();
</script>
{% endblock %}

{% extends 'peerinst/base.html' %}

{% load bleach_html static compress i18n %}

{% block mdc %}{% endblock %}

{% block stylesheets %}
{{ block.super }}
{% compress js file preact %}
<script src="{% static 'peerinst/js/preact.min.js' %}" defer="true"></script>
{% endcompress %}
{% compress js file assignment %}
<script src="{% static 'peerinst/js/assignment.min.js' %}" defer="true"></script>
{% endcompress %}
{% compress css file assignment %}
<link href="{% static 'peerinst/js/assignment.min.css' %}" rel="stylesheet">
{% endcompress %}
{% compress css file rmwc %}
<link href="{% static 'peerinst/css/rmwc.min.css' %}" rel="stylesheet">
{% endcompress %}
{% endblock %}

{% block body %}
<main>
  <section>
    <h1 class="mdc-typography--display3">{% trans 'Update Assignment' %}
      <svg class="underline" width=150 height=4></svg>
    </h1>

    <div class="admin-link">
      <a href="{% url 'teacher' teacher.id %}">{% trans 'Back to My Account' %}</a>
      <span class="links-divider">|</span><a href="{% url 'teacher-assignments' teacher.id %}">{% trans 'Back to My Assignments' %}</a>
      <span class="links-divider">|</span><a href="{% url 'question-create' %}">{% trans 'Create new question' %}</a>
    </div>

    <h2 id="assignment" class="mdc-typography--display1 mdc-theme--secondary">{{ object.title }}</h2>

    <div class="admin-link">
      <a href="{% url 'assignment-edit' object.pk %}">{% trans 'Edit title' %}</a>
      <span class="links-divider">|</span><a href="{% url 'question-list' object.pk %}">{% trans 'Preview' %}</a>
    </div>

    <div id="assignment-update-app"></div>

    <h2 class="mdc-typography--display1 mdc-theme--secondary">{% trans 'Search database' %}</h2>

    <div id="search-db-app"></div>

    <div id="search_results"></div>

  </section>
</main>
{% endblock %}

{% block scripts %}
{{ block.super }}
<script nonce="{{ request.csp_nonce }}">
  window.addEventListener("load", function() {
    function render() {
      console.debug("Callback");
      preact.render(assignmentUpdateApp(), document.getElementById("assignment-update-app"));
    }

    const assignmentUpdateApp = () => {
      return preact.h(
        assignment.AssignmentUpdateApp, {
          assignmentURL: "{% url 'REST:assignment-detail' object.pk %}?format=json",
          assignmentQuestionURL: "{% url 'REST:assignment_question-list' %}",
          gettext: gettext,
          nonce: "{{ request.csp_nonce }}",
          questionCloneBaseURL: "/question/clone/",
          questionEditBaseURL: "/question/update/",
          user: "{{ request.user }}",
        });
    }

    const searchDbApp = preact.h(assignment.SearchDbApp, {
      assignment: "{{ object.pk }}",
      assignmentQuestionURL: "{% url 'REST:assignment_question-list' %}",
      callback: render,
      disciplineURL: "{% url 'REST:discipline-list' %}",
      defaultDiscipline: "{{ teacher.disciplines.first.pk }}",
      gettext: gettext,
      questionCloneBaseURL: "/question/clone/",
      questionEditBaseURL: "/question/update/",
      searchURL: "{% url 'REST:question-search' %}",
      type: "assignment",
      user: "{{ request.user }}",
    });
    preact.render(searchDbApp, document.getElementById("search-db-app"))

    render();
  })
</script>

{% endblock %}

{% extends 'peerinst/base.html' %}

{% load i18n %}
{% load get_value %}
{% block body %}

<main>

    <section>
    <h1 class="mdc-typography--display3" style="position:sticky;">{% trans 'Report' %}
        <svg class="underline" width=150 height=4></svg>
    </h1>
    <div class="admin-link">
        <a href="{% url 'teacher' pk=teacher.pk %}">{% trans 'Back to My Account' %}</a>
    </div>

        <span>
            <h2 class="mdc-typography--display1 mdc-theme--secondary">{% trans 'Question-level Gradebook' %}</h2>

            <table>
                <tr>
                    <td>Question</td>
                    {% for label in gradebook_keys %}
                    <td>{{ label }}</td>
                    {% endfor %}
                </tr>
                {% for question in gradebook_question %}
                <tr>
                    <td>{{question.question.title}}</td>

                        {% for label in gradebook_keys %}
                            <td>{{ question|get_value:label }}</td>
                        {% endfor %}
                </tr>
                {% endfor %}               
            </table>
        </span>

        <span>
            <h2 class="mdc-typography--display1 mdc-theme--secondary">{% trans 'Student-level gradebook' %}</h2>
            <table>
                <tr>
                    <td>Student</td>
                        {% for label in gradebook_keys %}
                            <td>{{ label }}</td>
                        {% endfor %}
                        {% for question in question_list %}
                            <td> {{ question.title }} </td>                        
                        {% endfor %}
                </tr>
            {% for student in gradebook_student %}
                <tr>
                    <td>{{student.student}}</td><td>{{student.N}}</td><td>{{student.RR}}</td><td>{{student.RW}}</td><td>{{student.WR}}</td><td>{{student.WW}}</td>

                    {% for question in question_list %}
                        <td> {{ student|get_value:question }}</td>
                    {% endfor %}

                </tr>
            {% endfor %}               
            </table>
        </span>
        
        <h2 class="mdc-typography--display1 mdc-theme--secondary">{% trans 'Details by Assignment' %}</h2>
        <ul>
            {% for assignment in data %}
            <li>
                <span>
                <h3>{{ assignment.assignment }}</h3>

                <span>
                    <h4>Overall Student Transitions</h4>
                    <ul>
                    {% for transition in assignment.transitions %}
                        <li>{{ transition.transition_type }} : {{ transition.count }}</li>
                    {% endfor %}
                    </ul>
                </span>

                {% for question in assignment.questions %} 
                    {% if question.show %}               
                    <ul>
                        <li>
                            <span>
                                <h4>Question : {{ question.title }}</h4>
                                {{ question.text|striptags }}
                                {% if question.question_image %}
                                    <div>
                                      <img style="display:block;margin:auto;
                                      padding-top:10pt;
                                      padding-bottom:10pt;"  src="{{ question.question_image.url }}"
                                           alt="g.question.image_alt_text">
                                    </div>
                                {% endif %}
                            </span>

                            <span>
                            <h4>Summary</h4>
                                Total Number Responses: {{ question.num_responses}} 
                                {% for distribution in question.answer_distributions %}
                                <div>
                                <h5>{{ distribution.label }}</h5>
                                <h6>Count:Answer Choice</h6>
                                    <ul>
                                    {% for answer_choice in distribution.data %}
                                        <li> {{ answer_choice.count }} : {{ answer_choice.answer_choice }}
                                            {% if answer_choice.answer_choice_correct %}
                                            <em>(Correct)</em>
                                            {% endif %}
                                        </li>
                                    {% endfor %}
                                    </ul>
                                </div>
                                {% endfor %}

                                 <div>
                                {% for transition in question.transitions %}
                                <!-- <h4>{{ distribution.label }}</h4> -->
                                <h6>Count: Transition Type</h6>
                                    <ul>
                                    {% for answer_choice in transition.data %}
                                        <li> {{ answer_choice.count }} : {{ answer_choice.transition_type }}</li>
                                    {% endfor %}
                                    </ul>
                                {% endfor %}
                                </div>


                            </span>

                            <span>
                            <h4>Confusion Matrix</h4>
                            <table>
                                {% for first_ans in question.confusion_matrix %}
                                <tr>
                                    {% for second_ans in first_ans.second_answer_choice %}
                                    <td>{{second_ans.N}}</td>
                                    {% endfor %}
                                </tr>
                                {% endfor %}                                
                            </table>
                            </span>

                            <span>
                            <h4>Student Responses</h4>
                                <table>
                                    <th>
                                    <tr>
                                        <td>Student</td>
                                        <td>First Answer</td>
                                        <td>Rationale</td>
                                        <td>Second Answer</td>
                                        <td>Chosen Rationale</td>
                                    </tr>
                                    </th>
                                {% for student_response in question.student_responses %}
                                    
                                    <tr>
                                        <td>{{ student_response.student }}</td>
                                        <td>{{ student_response.first_answer_choice }}</td>
                                        <td>{{ student_response.rationale }}</td>
                                        <td>{{ student_response.second_answer_choice }}</td>
                                        <td>{{ student_response.chosen_rationale }}</td>
                                    </tr>
                                    
                                {% endfor %}
                                </table>
                            </span>

                        </li>
                    </ul>
                    {% endif %}
                {% endfor %}
                </span>
            </li>

            {% endfor %}
        
        </ul>                        

    </section>

</main>
{% endblock %}
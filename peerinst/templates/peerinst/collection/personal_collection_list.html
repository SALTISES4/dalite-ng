{% extends 'peerinst/base.html' %}

{% load staticfiles compress i18n %}

{% block stylesheets %}
{% compress css %}
<link href="{% static 'peerinst/css/collection.min.css' %}" rel="stylesheet">
{% endcompress %}
<style nonce="{{ request.csp_nonce }}">



#card-featured {
    background-color:powderblue;
  }


  #collection-view {
      color:#004266;
    }

</style>
{% endblock %}
{% block body %}
<main>
<section>
<h1 class="mdc-typography--display3">{% trans 'Browse Your Collections' %}
  <svg class="underline" width=150 height=4></svg>
</h1>

  {% if user.is_staff %}
    <div class="admin-link"><a href="{% url 'admin_index_wrapper' %}">Click here to access admin</a></div>
  {% endif %}
  <div class="admin-link"><a href="{% url 'collection-list' %}">{% trans 'View all collections' %}</a> |
  <a href="{% url 'followed-collection-list' %}">{% trans 'View your followed collections' %}</a> |
  <a href="{% url 'featured-collection-list' %}">{% trans 'View featured collections' %}</a> |
  <a href="{% url 'collection-create' %}">{% trans 'Create a collection' %}</a></div>

<ul>

{% for obj in object_list %}

<li class="dense-list searchable">
<div class="mdc-card" id="card{% if obj.featured == True %}-featured{% endif %}">
     <div class='click-box'  onclick="location.href='{{ obj.pk }}';">
  <div class="mdc-typography--title bold">
    {{ obj.title }}
  </div>

  <div class="mdc-typography--caption">
    {% trans 'Created by' %} {{ obj.owner.user.username }}
  </div>

  <div class="mdc-typography--body1" style="margin-top:5px;">
    {{ obj.description }}
  </div>
  </div>

  <div class="mdc-card__actions">

    <div class="mdc-card__action-buttons" style="color:grey;">
      <div class="mdc-typography--caption">
        <div>
          {% trans 'Discipline' %}: {{ obj.discipline }}
        </div>
        <div>
          {% trans 'Published on' %} {{obj.created_on}}
        </div>
      </div>
        <a id="collection-view" href="{% url 'collection-detail' obj.pk %}"><b>{% trans 'Click Here to View' %}</b></a>
    </div>
      </div>
    </div>

  <div class="mdc-card__action-icons">


    <i class="mdc-icon-toggle material-icons mdc-theme--primary"
        role="button"
        aria-pressed="false"
        aria-label="Add to favorites" tabindex="0"
        {% if request.user.teacher in obj.followers.all %}
        data-toggle-off='{"label": "Remove from favourites", "content": "favorite"}'
        data-toggle-on='{"label": "Add to favourites", "content": "favorite_border"}'
        {% else %}
        data-toggle-on='{"label": "Remove from favourites", "content": "favorite"}'
        data-toggle-off='{"label": "Add to favourites", "content": "favorite_border"}'
        {% endif %}
        pk="{{ obj.pk }}">
        favorite_border
    </i>

  </div>
</div>
</div>


  </li>
{% empty %}
  <li>{% trans 'No collections available.' %}</li>
{% endfor %}
</ul>


</section>
</main>
{% endblock %}

{% block scripts %}
{% compress js inline %}
<script nonce="{{ request.csp_nonce }}">

  [].forEach.call(document.querySelectorAll(".mdc-icon-toggle"), el => {
    bundle.iconToggle.MDCIconToggle.attachTo(el);
  });

  $.ajaxSetup({
      beforeSend: function(xhr, settings) {
          if (!bundle.csrfSafeMethod(settings.type) && !this.crossDomain) {
              xhr.setRequestHeader("X-CSRFToken", bundle.getCsrfToken());
          }
      }
  });


  function toggleFollower(pk) {
    var posting = $.post("{% url 'teacher-toggle-follower' %}", {pk: pk});
    posting.done(function(data) {
      console.info(data);
    })
  }


  [].forEach.call(document.querySelectorAll(".follower-btn"), el => {
    el.addEventListener("click", () => {
      toggleFollower(el.getAttribute('pk'));
    });
  });


</script>

{% endcompress %}
{% endblock %}

{% extends 'peerinst/base.html' %}

{% load compress i18n %}

{% block body %}
<main>
<section>
<h1 class="mdc-typography--display3" style="position:sticky;">{% trans 'My Account' %}
  <svg class="underline" width=150 height=4></svg>
</h1>
<h2 class="mdc-typography--display1 mdc-theme--secondary">{% trans 'Identity' %}</h2>
<ul class="mdc-list mdc-list--two-line">
  <li role="separator" class="mdc-list-divider"></li>
  <li class="mdc-list-item" onclick="edit_user()">
    <span class="mdc-list-item__graphic mdc-theme--primary"><i class="material-icons md-48">account_circle</i></span>
    <span class="mdc-list-item__text mdc-theme--secondary bold">
      {{ object.user.username }}
      <span class="mdc-list-item__secondary-text">
        {% trans "Email: " %} {{ object.user.email }}
      </span>
      <span class="mdc-list-item__secondary-text">
        {% trans "Member since: " %} {{ user.date_joined|date:"M d Y"  }}
      </span>
    </span>
    <span class="mdc-list-item__meta"><i class="material-icons md-24">lock</i></span>
  </li>
  <li role="separator" class="mdc-list-divider"></li>
  <li class="mdc-list-item" onclick="edit_identity()">
    <span class="mdc-list-item__graphic mdc-theme--primary"><i class="material-icons md-48">book</i></span>
    <span class="mdc-list-item__text mdc-theme--secondary bold">
      {% for d in object.disciplines.all %}
        {{ d.title }}{% if not forloop.last %}, {% endif %}
      {% endfor %}
      <span class="mdc-list-item__secondary-text">
        {% trans "Discipline" %}
      </span>
    </span>
    <span class="mdc-list-item__meta"><i class="material-icons md-24">settings</i></span>
  </li>
  <li role="separator" class="mdc-list-divider"></li>
  <li class="mdc-list-item" onclick="edit_identity()">
    <span class="mdc-list-item__graphic mdc-theme--primary"><i class="material-icons md-48">school</i></span>
    <span class="mdc-list-item__text mdc-theme--secondary bold">
      {% for i in object.institutions.all %}
        {{ i.name }}{% if not forloop.last %}, {% endif %}
      {% endfor %}
      <span class="mdc-list-item__secondary-text">
        {% trans "Institution" %}
      </span>
    </span>
    <span class="mdc-list-item__meta"><i class="material-icons md-24">settings</i></span>
  </li>
  <li role="separator" class="mdc-list-divider"></li>
</ul>


<h2 class="mdc-typography--display1 mdc-theme--secondary">{% trans 'Blink scripts' %}</h2>
<div class="admin-link">
  <a href="{% url 'blinkAssignment-create' %}">{% trans 'Add script' %}</a>
</div>
{% if not object.blinkassignment_set.all %}
<p>{% blocktrans %}A blink script is a series of blink questions strung together into one activity.  You do not have any blink scripts.{% endblocktrans %}</p>
{% endif %}
<p>{% trans 'Student link' %}: <span class="bold">{{ request.get_host}}{% url 'blink-get-current' object.user.username %}</span></p>

<ul class="mdc-list mdc-list--two-line mdc-list--non-interactive">
  {% for a in object.blinkassignment_set.all %}
  <li role="separator" class="mdc-list-divider"></li>
  <li class="mdc-list-item blink" id="edit-blink-{{a.pk}}">
    <span class="mdc-list-item__graphic mdc-theme--primary">
      {% if a.blinkassignmentquestion_set.all|length > 0 %}
        <a href="{% url 'blinkAssignment-start' a.key %}" style="transform:translateY(4pt);">
          <i class="mdc-theme--primary material-icons md-48">play_circle_filled</i>
        </a>
      {% endif %}
    </span>
    <span class="mdc-list-item__text mdc-theme--secondary bold">
      {{a.title|safe|striptags}}
      <span class="mdc-list-item__secondary-text">
        {{a.blinkassignmentquestion_set.count}} {% trans 'question(s)' %}
      </span>
    </span>
    <span class="mdc-list-item__meta">
      <a href="{% url 'blinkAssignment-delete' a.key %}">
        <i class="material-icons md-24 mdc-ripple-surface icon-list">delete</i>
      </a>
      <a href="{% url 'blinkAssignment-update' a.pk %}">
        <i class="material-icons md-24 mdc-ripple-surface icon-list">mode_edit</i>
      </a>
    </span>
  </li>
  {% endfor %}
  <li role="separator" class="mdc-list-divider"></li>
</ul>


<h2 class="mdc-typography--display1 mdc-theme--secondary">{% trans 'Assignments' %}</h2>
<div class="admin-link">
  <a href="{% url 'teacher-assignments' teacher.id %}">{% trans 'Manage assignments' %}</a>
</div>
{% if not object.assignments.all %}
<p>{% blocktrans %}You do not have any assignments.{% endblocktrans %}</p>
{% endif %}
<ul class="mdc-list mdc-list--two-line mdc-list--non-interactive">
  {% for a in object.assignments.all %}
  <li role="separator" class="mdc-list-divider"></li>
  <li class="mdc-list-item">
    <span class="mdc-list-item__graphic mdc-theme--primary">
        <a href="" style="transform:translateY(4pt);">
          <i class="mdc-theme--primary material-icons md-48">assignment</i>
        </a>
    </span>
    <span class="mdc-list-item__text mdc-theme--secondary bold">
      {{ a.identifier }}
      <span class="mdc-list-item__secondary-text">
        {{ a.questions.count }} {% trans "questions" %}
      </span>
    </span>
    <span class="mdc-list-item__meta">
      <i id="activate-dialog-{{a.pk|slugify}}" class="material-icons md-24 mdc-ripple-surface icon-list">help</i>
      <a href="{% url 'assignment-update' a.pk %}">
        <i class="material-icons md-24 mdc-ripple-surface icon-list">mode_edit</i>
      </a>
    </span>
  </li>

  <aside id="dialog-{{a.pk|slugify}}"
    class="mdc-dialog"
    role="alertdialog"
    aria-labelledby="assignment-parameters-label"
    aria-describedby="assignment-parameters-description">
    <div class="mdc-dialog__surface">
      <header class="mdc-dialog__header">
        <h2 id="assignment-parameters-label" class="mdc-dialog__header__title">
          {% trans 'Assignment LTI parameters' %}
        </h2>
      </header>
      <section id="assignment-parameters-description" class="mdc-dialog__body mdc-dialog__body--scrollable">
        <p class="mdc-typography--body1">{% blocktrans %}Import each question using the parameters listed below{% endblocktrans %}:</p>
        <ul>
        {% for q in a.questions.all %}
          <li><span class="bold">{% trans 'Question' %} {{ forloop.counter }}:</span>
            <ul>
              <li>{% trans 'LTI key' %}: {{ LTI_key }}</li>
              <li>{% trans 'Assignment id' %}: {{ a.identifier }}</li>
              <li>{% trans 'Question id' %}: {{ q.id }}</li>
            </ul>
        {% endfor %}
        </ul>
      </section>
      <footer class="mdc-dialog__footer">
        <button type="button" class="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept">Ok</button>
      </footer>
    </div>
    <div class="mdc-dialog__backdrop"></div>
  </aside>

  {% endfor %}
  <li role="separator" class="mdc-list-divider"></li>
</ul>


<h2 class="mdc-typography--display1 mdc-theme--secondary">{% trans 'Groups' %}</h2>
<div class="admin-link">
  <a href="{% url 'teacher-groups' teacher.id %}">{% trans 'Manage groups' %}</a>
</div>
{% if not object.groups.all %}
<p>{% blocktrans %}You are not currently following any student groups.{% endblocktrans %}</p>
{% endif %}
<ul class="mdc-list mdc-list--two-line">
  {% for g in object.groups.all %}
  <li role="separator" class="mdc-list-divider"></li>
  <li class="mdc-list-item" onclick="edit_groups()">
    <span class="mdc-list-item__graphic mdc-theme--primary">
      <i class="mdc-theme--primary material-icons md-48">group</i>
    </span>
    <span class="mdc-list-item__text mdc-theme--secondary bold">
      {{ g.name }}
      <span class="mdc-list-item__secondary-text">
        {% trans "Created: " %}{{ g.creation_date }}
      </span>
      <span class="mdc-list-item__secondary-text">
        {% trans "Students: " %} {{ g.student_set.count  }}
      </span>
    </span>
    <span class="mdc-list-item__meta"><i class="material-icons md-24">info</i></span>
  </li>
  {% endfor %}
  <li role="separator" class="mdc-list-divider"></li>
</ul>

</section>
</main>
{% endblock %}

{% block scripts %}
{% compress js inline %}
<script>
document.querySelectorAll("[id^=dialog]").forEach(
  (el,i,list) => {
    const dialog = bundle.dialog.MDCDialog.attachTo(el);
    document.querySelector("#activate-"+el.id).onclick = () => {
      dialog.show();
    }
  }
);

// This needs to be fix to activate JS part of ripple
document.querySelectorAll('.ripple-icon').forEach(
  (el,i,list) => {
  //  const ripple = bundle.ripple.MDCRipple.attachTo(el);
  //  ripple.unbounded = true;
  }
);
function edit_user() {
  location="{% url 'password_change' %}";
}
function edit_identity() {
  location="{% url 'teacher-update' teacher.id %}";
}
function edit_groups() {
  location="{% url 'teacher-groups' teacher.id %}";
}
</script>

{% for a in object.blinkassignment_set.all %}
<script>
// Bind onclick
/*document.getElementById('edit-blink-{{a.pk}}').onclick=function() {
  location="{% url 'blinkAssignment-update' a.pk %}";
}*/
/*document.querySelectorAll('.blink').forEach(
  (el,i,list)=>{
    el.onclick=function() {
      location="";
    }
  });*/
</script>
{% endfor %}
{% endcompress %}
{% endblock %}

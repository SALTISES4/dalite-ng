{% extends 'peerinst/question/review_base.html' %}

{% load bleach_html i18n %}

{% block answers %}
  {{ block.super }}
  <p>
    {% if sequential_review %}
      {% blocktrans %}
        Consider the problem again, and select the most convincing rationale.
      {% endblocktrans %}
    {% else %}
      {% blocktrans %}
        Consider the problem again, noting the rationales below that have been provided by other
        students.  They may, or may not, cause you to reconsider your answer.  Read them and select your
        final answer.
      {% endblocktrans %}
    {% endif %}
  </p>
{% endblock %}

{% block inner_form %}
  {{ form.non_field_errors }}
  <div class="rationales">
    {% for second_answer_choice, rationale_choice, show_more_counters, label, rationale_ids, text in form.rationale_groups %}
      <div class="rationale" id="rationales-{{ forloop.counter0 }}">
        <div class="rationale-choice"><strong>{{ second_answer_choice }}. {{ text.strip|bleach_html|safe }}</strong></div>
        <div class="rationale-text-container">
          {{ rationale_choice.errors }}
          <div class="m3-radio-group" role="radiogroup" aria-label="{% trans 'Second answer choice rationales' %}">
            {% for r in rationale_choice %}
              <div {% if forloop.counter > 2 %}class="hidden-{{ forloop.parentloop.counter }}" hidden{% endif %}>
                <div class="m3-radio-label">
                  <md-radio
                    aria-label="{{ r.choice_label.strip|bleach_html|safe }}"
                    id="{{ r.data.attrs.id }}"
                    name="{{ r.data.name }}"
                    value="{{ r.data.value }}">
                  </md-radio>
                  <label for="{{ r.id_for_label }}">{{ r.choice_label.strip|bleach_html|safe }}</label>
                </div>
              </div>

              {% if forloop.counter > 2 and forloop.last %}
                <input type="{{ show_more_counters.type }}"
                  name="{{ show_more_counters.name }}"
                  id="show-counter-{{ forloop.parentloop.counter }}"
                  value="2" hidden >
                <div class="expand-button" data-rationale-iterator="{{ forloop.parentloop.counter }}">
                  <i class="material-icons"
                    role="button"
                    aria-pressed="false"
                    aria-label="{% trans 'Show more rationales' %}"
                    title="{% trans 'Show more rationales' %}">
                    add
                  </i><span>{% trans 'Show more rationales' %}</span>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
        {% if not forloop.last %}
          <md-divider></md-divider>
        {% endif %}
      </div>
    {% endfor %}
  </div>
{% endblock %}

{% block submit_button_fct %}{% endblock %}
{% block submit_button %}{% trans 'Submit' %}{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script nonce="{{ request.csp_nonce }}">
    window.addEventListener("load", function() {
      question.initReview();
      question.initForm();
    });
  </script>
{% endblock %}

!function(t){"use strict";function e(){return document.getElementsByName("csrfmiddlewaretoken")[0].getAttribute("value")}function n(t,n){if("get"===n.toLowerCase())return{method:n.toUpperCase(),headers:{"Content-Type":"application/json","X-CSRFToken":e()}};if("post"===n.toLowerCase()){const o=t?JSON.stringify(t):"";return{method:n.toUpperCase(),body:o,headers:{"Content-Type":"application/json","X-CSRFToken":e()}}}throw Error("Method ".concat(n," not implemented yet."))}function o(t){for(;t.hasChildNodes();)t.removeChild(t.lastChild);return t}let i,s;function d(t,e){const o=i.urls.saveStudentId,s=n({student_id:e.querySelector("input").value,group_name:t.name},"post");fetch(o,s).then(t=>t.json()).then((function(n){t.studentId=n.student_id,_(t,e)})).catch((function(n){_(t,e),console.log(n)}))}function a(t,e){navigator.clipboard.writeText(t.studentId).then(()=>function(t){const e=document.createElement("div");e.classList.add("bubble"),e.textContent="Copied to clipboard!",t.appendChild(e),setTimeout(()=>t.removeChild(e),600)}(e))}function c(){const t=i.urls.tosModify+"?next="+window.location.href;window.location.href=t}function l(){i.joiningGroup=!i.joiningGroup,m()}function r(t){"Enter"===t.key?u():(t.currentTarget.value&&g("",!1),f())}function u(){const t=i.urls.joinGroup,e=document.querySelector("#student-add-group--box input"),o=document.querySelector("#student-add-group--box select");let s;if(e.value)s={username:i.student.username,group_link:e.value};else{if(!i.groups.some(t=>!t.memberOf))return void g("A URL is needed.",!0);s={username:i.student.username,group_name:o.value}}const d=n(s,"post");fetch(t,d).then(t=>t.json()).then((function(t){e.value="",i.groups.some(e=>e.name===t.name)?i.groups.filter(e=>e.name===t.name)[0].memberOf=t.member_of:i.groups.push({name:t.name,title:t.title,notifications:t.notifications,memberOf:t.member_of,assignments:t.assignments.map(t=>({title:t.title,dueDate:new Date(t.due_date),link:t.link,results:{n:t.results.n,grade:t.results.grade},done:t.done,almostExpired:t.almost_expired})),studentId:t.student_id,studentIdNeeded:t.student_id_needed}),l(),y()})).catch((function(t){g("There is no group with that link.",!0)}))}function p(t){!function(){document.getElementById("student-email").textContent=i.student.email;document.getElementById("student-member-since").textContent=i.student.memberSince.toLocaleString("en-ca",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"});const t=document.getElementById("student-tos-sharing--icon"),e=document.getElementById("student-tos-sharing--sharing");i.student.tos.sharing?(t.textContent="check",e.textContent=i.translations.sharing):(t.textContent="clear",e.textContent=i.translations.notSharing);document.getElementById("student-tos-signed-on").textContent=i.student.tos.signedOn.toLocaleString("en-ca",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}(),y(t),m()}function m(){const t=document.getElementById("student-add-group--box"),e=document.querySelector("#student-add-group--box input");i.joiningGroup?(!function(){const t=document.getElementById("student-old-groups");o(t);const e=i.groups.filter(t=>!t.memberOf);e.length?(e.map(e=>t.appendChild(function(t){const e=document.createElement("option");return e.value=t.name,e.textContent=t.title,e}(e))),t.style.display="inline-block",f()):t.style.display="none"}(),t.style.display="flex"):(t.style.display="none",e.value=""),g("",!1)}function g(t,e){const n=document.getElementById("student-add-group__error"),o=document.querySelector("#student-add-group--box input");n.textContent=t,e?(n.removeAttribute("hidden"),o.classList.add("input--error")):(n.setAttribute("hidden",""),o.classList.remove("input--error"))}function f(){const t=document.querySelector("#student-add-group--box input"),e=document.querySelector("#student-add-group--box select");t.value?e.disabled=!0:e.disabled=!1}function y(t=""){const e=document.getElementById("student-groups");if(o(e),i.groups.filter(t=>t.memberOf).map(t=>e.appendChild(function(t){const e=document.createElement("div");return e.classList.add("student-group"),e.setAttribute("data-group",t.name),e.appendChild(function(t){const e=document.createElement("div");e.classList.add("student-group--title"),t.studentIdNeeded&&e.appendChild(function(t){const e=document.createElement("div");e.classList.add("student-group--id");const n=document.createElement("i");n.classList.add("material-icons","md-28","student-group--id__copy"),n.style.display="flex",n.textContent="file_copy",n.addEventListener("click",()=>a(t,e)),e.appendChild(n);const o=document.createElement("span");o.classList.add("student-group--id__id"),o.style.display="inline-block",o.textContent=t.studentId,o.title=i.translations.studentId,o.addEventListener("click",()=>h(t,e)),e.appendChild(o);const s=document.createElement("input");s.classList.add("student-group--id__input"),s.value=t.schoolId,s.style.display="none",s.addEventListener("keydown",n=>function(t,e,n){"Enter"===t?d(e,n):"Escape"===t&&_(e,n)}(n.key,t,e)),e.appendChild(s);const c=document.createElement("i");c.classList.add("material-icons","md-28","student-group--id__edit"),c.style.display="flex",c.textContent="edit",c.title=i.translations.editStudentId,c.addEventListener("click",()=>h(t,e)),e.appendChild(c);const l=document.createElement("i");l.classList.add("material-icons","md-28","student-group--id__confirm"),l.style.display="none",l.textContent="check",l.addEventListener("click",()=>d(t,e)),e.appendChild(l);const r=document.createElement("i");return r.classList.add("material-icons","md-28","student-group--id__cancel"),r.style.display="none",r.textContent="close",r.addEventListener("click",()=>_(t,e)),e.appendChild(r),e}(t));const o=document.createElement("h3");o.textContent=t.title,e.appendChild(o);const s=document.createElement("div");if(s.classList.add("student-group--icons"),e.appendChild(s),t.connectedCourseUrl){const e=document.createElement("div");e.classList.add("student-group--course"),s.appendChild(e);const n=document.createElement("i");n.classList.add("material-icons","md-28"),n.title=i.translations.courseFlowButton,n.addEventListener("click",()=>window.location.href=t.connectedCourseUrl),n.classList.add("course-flow-button"),n.textContent="calendar_today",e.appendChild(n)}const c=document.createElement("div");c.classList.add("student-group--notifications"),s.appendChild(c);const l=document.createElement("i");l.classList.add("material-icons","md-28"),l.title=i.translations.notificationsBell,l.addEventListener("click",()=>function(t,e){const o=i.urls.studentToggleGroupnotifications,s=n({group_name:t.name},"post");fetch(o,s).then(t=>t.json()).then((function(n){t.notifications=n.notifications,t.notifications?(e.textContent="notifications",e.classList.remove("student-group--notifications__disabled")):(e.textContent="notifications_off",e.classList.add("student-group--notifications__disabled"))})).catch((function(t){console.log(t)}))}(t,l)),t.notifications?l.textContent="notifications":(l.textContent="notifications_off",l.classList.add("student-group--notifications__disabled"));return c.appendChild(l),s.appendChild(function(t,e){const o=document.createElement("div");o.classList.add("student-group--remove"),o.title=i.translations.leaveGroupTitle;const s=document.createElement("i");s.classList.add("material-icons","md-28"),s.addEventListener("click",()=>C(e)),s.textContent="remove_circle_outline",o.appendChild(s);const d=document.createElement("div");d.classList.add("student-group--remove-confirmation-box"),d.style.display="none",d.addEventListener("click",(function(t){t.stopPropagation,C(e)})),o.appendChild(d);const a=document.createElement("div");a.addEventListener("click",t=>t.stopPropagation()),d.appendChild(a);const c=document.createElement("h3");c.textContent=i.translations.leaveGroupTitle+" "+t.title,a.appendChild(c);const l=document.createElement("p");l.textContent=i.translations.leaveGroupText,a.appendChild(l);const r=document.createElement("p");r.textContent=i.translations.leaveGroupQuestion,a.appendChild(r);const u=document.createElement("button");u.classList.add("mdc-button","mdc-button--unelevated"),u.addEventListener("click",()=>function(t,e){const o=i.urls.leaveGroup,s=n({group_name:t.name},"post");fetch(o,s).then((function(e){e.ok?(i.groups.filter(e=>e.name===t.name)[0].memberOf=!1,y()):console.log(e)})).catch(t=>console.log(t))}(t)),u.textContent=i.translations.leave,a.appendChild(u);const p=document.createElement("button");return p.classList.add("mdc-button"),p.addEventListener("click",()=>C(e)),p.textContent=i.translations.cancel,a.appendChild(p),o}(t,e)),e}(t)),e.appendChild(function(t){const e=document.createElement("div");if(e.classList.add("student-group--assignments"),t.assignments.length){const n=document.createElement("ul");t.assignments.map(e=>n.appendChild(function(t,e){document.createElement("a").href=t.link;const n=document.createElement("li");n.classList.add("student-group--assignment"),t.done&&n.classList.add("student-group--assignment-complete");n.addEventListener("click",n=>function(t,e){t.studentIdNeeded&&""===t.studentId?v(t):window.location=e.link}(e,t));const o=new Date(t.dueDate);o.setDate(o.getDate()-i.expiryBlinkingDelay);const s=document.createElement("span");s.classList.add("student-group--assignment-icon"),n.appendChild(s);const d=document.createElement("i");d.classList.add("material-icons","md-28"),t.done?(s.title=i.translations.goToAssignment,d.textContent="assignment_turned_in"):t.dueDate<=new Date(Date.now())?(s.title=i.translations.assignmentExpired,d.textContent="assignment_late"):o<=new Date(Date.now())?(s.title=i.translations.assignmentAboutToExpire,d.textContent="assignment_late"):(s.title=i.translations.goToAssignment,d.textContent="assignment");s.appendChild(d);const a=document.createElement("span");a.classList.add("student-group--assignment-questions"),a.title=i.translations.grade,n.appendChild(a);const c=document.createElement("span");c.textContent=t.results.grade,a.appendChild(c);const l=document.createElement("span");l.textContent="/",a.appendChild(l);const r=document.createElement("span");r.textContent=t.results.n,a.appendChild(r);const u=document.createElement("span");u.classList.add("student-group--assignment-title"),u.title=i.translations.goToAssignment,u.textContent=t.title,n.appendChild(u);const p=document.createElement("span");if(p.classList.add("student-group--assignment-date"),t.done)p.removeAttribute("title"),p.textContent=i.translations.completed;else if(t.dueDate<=new Date(Date.now()))p.title=i.translations.assignmentExpired,p.textContent=i.translations.expired;else{p.title=i.translations.dueOn+" "+t.dueDate.toLocaleString("en-ca",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"});const e=document.createElement("i");e.classList.add("material-icons","md-18"),e.textContent="access_time",p.appendChild(e);const n=document.createElement("span");n.textContent=function(t,e){let n=t-e;const o=Math.floor(n/1e3/60/60/24);n-=24*o*60*60*1e3;const s=Math.floor(n/1e3/60/60);n-=60*s*60*1e3;const d=Math.floor(n/1e3/60);let a="";o>1?a=a+parseInt(o)+" "+i.translations.days+", ":1===o&&(a=a+parseInt(o)+" "+i.translations.day+", ");1===s?a=a+parseInt(s)+" "+i.translations.hour+", ":(s>1||o)&&(a=a+parseInt(s)+" "+i.translations.hours+", ");a=1===d?a+parseInt(d)+" "+i.translations.minute:a+parseInt(d)+" "+i.translations.minutes;return a}(t.dueDate,new Date(Date.now())),p.appendChild(n),o<=new Date(Date.now())&&e.classList.add("blinking")}return n.appendChild(p),n}(e,t))),e.appendChild(n)}else{const t=document.createElement("span");t.classList.add("student-group--no-assignments"),t.textContent=i.translations.noAssignments,e.appendChild(t)}return e}(t)),e}(t))),t)for(let e=0;e<i.groups.length;e++)if(i.groups[e].name==t){v(i.groups[e]);break}}function h(t,e){const n=e.querySelector(".student-group--id__id"),o=e.querySelector(".student-group--id__input"),i=e.querySelector(".student-group--id__copy"),s=e.querySelector(".student-group--id__edit"),d=e.querySelector(".student-group--id__confirm"),a=e.querySelector(".student-group--id__cancel");o.value=t.studentId,n.style.display="none",i.style.display="none",s.style.display="none",o.style.display="inline-block",d.style.display="flex",a.style.display="flex",o.focus(),v(t)}function _(t,e){const n=e.querySelector("span"),o=e.querySelector("input"),i=e.querySelector(".student-group--id__copy"),s=e.querySelector(".student-group--id__edit"),d=e.querySelector(".student-group--id__confirm"),a=e.querySelector(".student-group--id__cancel");n.textContent=t.studentId,n.style.display="inline-block",i.style.display="flex",s.style.display="flex",o.style.display="none",d.style.display="none",a.style.display="none"}function v(t){var e;const n=document.querySelector(".student-group[data-group='".concat(t.name,"'] .student-group--id"));if("none"===(null===(e=n.querySelector(".student-group--id__input"))||void 0===e?void 0:e.style.display)){const t=document.createElement("div");t.classList.add("student-group--id__alert"),t.textContent=i.translations.studentIdNeeded,n.appendChild(t),t.scrollIntoView(!0)}else{const t=n.querySelector(".student-group--id__alert");null==t||t.parentNode.removeChild(t)}}function C(t){const e=t.querySelector(".student-group--remove-confirmation-box");"none"==e.style.display?e.style.display="flex":e.style.display="none"}function E(){document.getElementById("edit-user-btn").addEventListener("click",(function(){edit_user()})),document.getElementById("modify-tos-btn").addEventListener("click",(function(){c()})),document.querySelector("#student-add-group .admin-link").addEventListener("click",(function(){l()})),document.getElementById("student-add-group--box").addEventListener("click",(function(){event.stopPropagation})),document.querySelector("#student-add-group--box > div").addEventListener("click",(function(){event.stopPropagation})),document.querySelector("#student-add-group--box input[name='new-group']").addEventListener("keyup",(function(t){r(t)})),document.getElementById("join-group-btn").addEventListener("click",(function(){u()})),document.getElementById("cancel-join-group-btn").addEventListener("click",(function(){l()}))}function x(){const t=document.querySelector(".notifications");document.querySelectorAll(".header--togglable > *").forEach(e=>{e!=t&&e.hasAttribute("open")&&(e.shadowRoot?e.shadowRoot.querySelector(".header__icon").dispatchEvent(new Event("click")):e.querySelector(".header__icon").dispatchEvent(new Event("click")))}),s.notificationsOpen=!s.notificationsOpen,b()}function L(){const t=s.urls.removeNotifications,e=n({},"post");fetch(t,e).then((function(t){t.ok&&(s.notifications=[],b())})).catch((function(t){console.log(t)}))}function b(){const t=document.querySelector(".notifications"),e=t.querySelector(".notifications__icon__badge"),i=t.querySelector(".notifications__notifications");s.notifications.length?(e.textContent=s.notifications.length,e.style.display="flex"):(e.textContent="",e.style.display="none"),o(i),s.notifications.length?s.notifications.map((function(t){i.appendChild(function(t){const e=document.createElement("div");return e.classList.add("notification"),e.textContent=t.text,e.addEventListener("click",()=>function(t){const e=s.urls.removeNotification,o=n({notification_pk:t.pk},"post");fetch(e,o).then(t=>t.text()).then(e=>{e?window.location=s.urls.studentPage+"?group-student-id-needed="+e:t.link?window.location=t.link:(s.notifications.splice(s.notifications.indexOf(t),1),b())}).catch((function(t){console.log(t)}))}(t)),e}(t))})):i.appendChild(function(){const t=document.createElement("div");return t.classList.add("notifications__no-new"),t.textContent="No new notifications",t}()),s.notificationsOpen?(t.setAttribute("open",""),t.classList.add("notifications--open")):(t.removeAttribute("open"),t.classList.remove("notifications--open"))}function k(){var t,e,n;null===(t=document.querySelector(".notifications"))||void 0===t||t.addEventListener("click",(function(t){t.stopPropagation()})),null===(e=document.querySelector(".notifications__icon"))||void 0===e||e.addEventListener("click",(function(t){x()})),document.body.addEventListener("click",(function(t){s.notificationsOpen&&x()})),null===(n=document.querySelector(".notifications__read-all-btn"))||void 0===n||n.addEventListener("click",L)}t.handleJoinGroupLinkInput=r,t.initStudentHeader=function(t){if(document.querySelector(".notifications")){const e=n(null,"get");fetch(t,e).then(t=>t.json()).then((function(t){!function(t){s={notificationsOpen:!1,notifications:t.notifications,urls:{studentPage:t.urls.student_page,removeNotification:t.urls.remove_notification,removeNotifications:t.urls.remove_notifications}}}(t),k(),b()})).catch(t=>console.log(t))}},t.initStudentPage=function(t,e=""){!function(t){i={expiryBlinkingDelay:t.expiry_blinking_delay,joiningGroup:!1,newStudent:t.new_student,student:{username:t.student.username,email:t.student.email,memberSince:new Date(t.student.member_since),tos:{sharing:t.student.tos.sharing,signedOn:new Date(t.student.tos.signed_on)}},groups:t.groups.map(t=>({connectedCourseUrl:t.connected_course_url,name:t.name,title:t.title,notifications:t.notifications,memberOf:t.member_of,assignments:t.assignments.map(t=>({title:t.title,dueDate:new Date(t.due_date),link:t.link,results:{grade:t.results.grade,n:t.results.n},done:t.done,almostExpired:t.almost_expired})),studentId:t.student_id,studentIdNeeded:t.student_id_needed})),urls:{tosModify:t.urls.tos_modify,joinGroup:t.urls.join_group,leaveGroup:t.urls.leave_group,saveStudentId:t.urls.save_student_id,studentToggleGroupnotifications:t.urls.student_toggle_group_notifications},translations:{assignmentAboutToExpire:t.translations.assignment_about_to_expire,assignmentExpired:t.translations.assignment_expired,cancel:t.translations.cancel,completed:t.translations.completed,courseFlowButton:t.translations.course_flow_button,day:t.translations.day,days:t.translations.days,dueOn:t.translations.due_on,editStudentId:t.translations.edit_student_id,expired:t.translations.expired,goToAssignment:t.translations.go_to_assignment,grade:t.translations.grade,hour:t.translations.hour,hours:t.translations.hours,leave:t.translations.leave,leaveGroupQuestion:t.translations.leave_group_question,leaveGroupText:t.translations.leave_group_text,leaveGroupTitle:t.translations.leave_group_title,minute:t.translations.minute,minutes:t.translations.minutes,noAssignments:t.translations.no_assignments,notificationsBell:t.translations.notifications_bell,notSharing:t.translations.not_sharing,sharing:t.translations.sharing,studentId:t.translations.student_id,studentIdNeeded:t.translations.student_id_needed}}}(t),p(e),E()},t.joinGroup=u,t.modifyTos=c,t.toggleJoinGroup=l}(this.student=this.student||{});
//# sourceMappingURL=student.min.js.map

var student=function(t){"use strict";function e(t,e){return{method:e.toUpperCase(),body:JSON.stringify(t),headers:{"Content-Type":"application/json","X-CSRFToken":(n="csrftoken",document.cookie&&""!==document.cookie?document.cookie.split(";").filter(function(t){return t.replace(/^\s+/,"").replace(/\s+$/,"").substring(0,n.length+1)===n+"="}).map(function(t){return decodeURIComponent(t.substring(n.length+1)).replace(/^=/,"")})[0]:null)}};var n}var n=void 0;function i(){!function(){document.getElementById("student-email").textContent=n.student.email,document.getElementById("student-member-since").textContent=n.student.memberSince.toLocaleString("en-ca",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"});var t=document.getElementById("student-tos-sharing--icon"),e=document.getElementById("student-tos-sharing--sharing");n.student.tos.sharing?(t.textContent="check",e.textContent=n.translations.sharing):(t.textContent="clear",e.textContent=n.translations.notSharing);document.getElementById("student-tos-signed-on").textContent=n.student.tos.signedOn.toLocaleString("en-ca",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}(),s(),a(),o()}function s(){var t=document.getElementById("notifications");if(n.notifications.length){var i=t.querySelector("ul");n.notifications.map(function(t){return i.appendChild(function(t){var i=document.createElement("a");i.title=t.hoverText,i.addEventListener("click",function(){return function(t){var i=n.urls.removeNotification,o=e({notification_pk:t.pk},"post");fetch(i,o).then(function(e){e.ok?t.link?window.location=t.link:(n.notifications.splice(n.notifications.indexOf(t),1),s()):console.log(e)}).catch(function(t){return console.log(t)})}(t)});var o=document.createElement("li");o.classList.add("mdc-list-item"),i.appendChild(o);var a=document.createElement("span");a.classList.add("mdc-list-item__graphic","mdc-theme--primary"),o.appendChild(a);var r=document.createElement("i");r.classList.add("material-icons","md-36"),r.textContent=t.icon,a.appendChild(r);var d=document.createElement("span");return d.classList.add("mdc-list-item__text"),d.textContent=t.text,o.appendChild(d),i}(t))}),t.style.display="block"}else t.style.display="none"}function o(){var t=document.getElementById("student-add-group--box");n.joiningGroup?(!function(){var t=document.getElementById("student-old-groups");m(t);var e=n.groups.filter(function(t){return!t.memberOf});e.length?(e.map(function(e){return t.appendChild(function(t){var e=document.createElement("option");return e.value=t.name,e.textContent=t.title,e}(e))}),t.style.display="inline-block"):t.style.display="none"}(),t.style.display="flex"):t.style.display="none"}function a(){var t=document.getElementById("student-groups");m(t),n.groups.filter(function(t){return t.memberOf}).map(function(i){return t.appendChild(function(t){var i=document.createElement("div");return i.classList.add("student-group"),i.appendChild(function(t){var i=document.createElement("div");i.classList.add("student-group--title"),console.log(t.studentIdNeeded),t.studentIdNeeded&&i.appendChild(function(t){var e=document.createElement("div");e.classList.add("student-group--id");var i=document.createElement("i");i.classList.add("material-icons","md-28","student-group--id__copy"),i.style.display="flex",i.textContent="file_copy",i.addEventListener("click",function(){return function(t,e){navigator.clipboard.writeText(t.studentId).then(function(){return function(t){var e=document.createElement("div");e.classList.add("bubble"),e.textContent="Copied to clipboard!",t.appendChild(e),setTimeout(function(){return t.removeChild(e)},600)}(e)})}(t,e)}),e.appendChild(i);var s=document.createElement("span");s.classList.add("student-group--id__id"),s.style.display="inline-block",s.textContent=t.studentId,s.title=n.translations.studentId,s.addEventListener("click",function(){return r(t,e)}),e.appendChild(s);var o=document.createElement("input");o.classList.add("student-group--id__input"),o.value=t.schoolId,o.style.display="none",o.addEventListener("keydown",function(n){return function(t,e,n){"Enter"===t?u(e,n):"Escape"===t&&d(e,n)}(n.key,t,e)}),e.appendChild(o);var a=document.createElement("i");a.classList.add("material-icons","md-28","student-group--id__edit"),a.style.display="flex",a.textContent="edit",a.addEventListener("click",function(){return r(t,e)}),e.appendChild(a);var l=document.createElement("i");l.classList.add("material-icons","md-28","student-group--id__confirm"),l.style.display="none",l.textContent="check",l.addEventListener("click",function(){return u(t,e)}),e.appendChild(l);var c=document.createElement("i");return c.classList.add("material-icons","md-28","student-group--id__cancel"),c.style.display="none",c.textContent="close",c.addEventListener("click",function(){return d(t,e)}),e.appendChild(c),e}(t));var s=document.createElement("h3");s.textContent=t.title,i.appendChild(s);var o=document.createElement("div");o.classList.add("student-group--icons"),i.appendChild(o);var c=document.createElement("div");c.classList.add("student-group--notifications"),o.appendChild(c);var p=document.createElement("i");return p.classList.add("material-icons","md-28"),p.title=n.translations.notificationsBell,p.addEventListener("click",function(){return function(t,i){var s=n.urls.studentToggleGroupnotifications,o=e({group_name:t.name},"post");fetch(s,o).then(function(t){return t.json()}).then(function(e){t.notifications=e.notifications,t.notifications?(i.textContent="notifications",i.classList.remove("student-group--notifications__disabled")):(i.textContent="notifications_off",i.classList.add("student-group--notifications__disabled"))}).catch(function(t){console.log(t)})}(t,p)}),t.notifications?p.textContent="notifications":(p.textContent="notifications_off",p.classList.add("student-group--notifications__disabled")),c.appendChild(p),o.appendChild(function(t,i){var s=document.createElement("div");s.classList.add("student-group--remove"),s.title=n.translations.leaveGroupTitle;var o=document.createElement("i");o.classList.add("material-icons","md-28"),o.addEventListener("click",function(){return l(i)}),o.textContent="remove_circle_outline",s.appendChild(o);var r=document.createElement("div");r.classList.add("student-group--remove-confirmation-box"),r.style.display="none",r.addEventListener("click",function(t){t.stopPropagation,l(i)}),s.appendChild(r);var d=document.createElement("div");d.addEventListener("click",function(t){return t.stopPropagation()}),r.appendChild(d);var u=document.createElement("h3");u.textContent=n.translations.leaveGroupTitle+" "+t.title,d.appendChild(u);var c=document.createElement("p");c.textContent=n.translations.leaveGroupText,d.appendChild(c);var p=document.createElement("p");p.textContent=n.translations.leaveGroupQuestion,d.appendChild(p);var m=document.createElement("button");m.classList.add("mdc-button","mdc-button--unelevated"),m.addEventListener("click",function(){return function(t,i){var s=n.urls.leaveGroup,o=e({group_name:t.name},"post");fetch(s,o).then(function(e){e.ok?(n.groups.filter(function(e){return e.name===t.name})[0].memberOf=!1,a()):console.log(e)}).catch(function(t){return console.log(t)})}(t)}),m.textContent=n.translations.leave,d.appendChild(m);var g=document.createElement("button");return g.classList.add("mdc-button"),g.addEventListener("click",function(){return l(i)}),g.textContent=n.translations.cancel,d.appendChild(g),s}(t,i)),i}(t)),i.appendChild(function(t){var e=document.createElement("div");if(e.classList.add("student-group--assignments"),t.assignments.length){var i=document.createElement("ul");t.assignments.map(function(t){return i.appendChild(function(t){var e=document.createElement("a");e.href=t.link;var i=document.createElement("li");i.classList.add("student-group--assignment"),t.results.nSecondAnswered==t.results.n&&i.classList.add("student-group--assignment-complete"),e.appendChild(i);var s=new Date(t.dueDate);s.setDate(s.getDate()-n.expiryBlinkingDelay);var o=document.createElement("span");o.classList.add("student-group--assignment-icon"),i.appendChild(o);var a=document.createElement("i");a.classList.add("material-icons","md-28"),t.results.nSecondAnswered==t.results.n?(o.title=n.translations.goToAssignment,a.textContent="assignment_turned_in"):t.dueDate<=new Date(Date.now())?(o.title=n.translations.assignmentExpired,a.textContent="assignment_late"):s<=new Date(Date.now())?(o.title=n.translations.assignmentaboutToExpire,a.textContent="assignment_late"):(o.title=n.translations.goToAssignment,a.textContent="assignment"),o.appendChild(a);var r=document.createElement("span");r.classList.add("student-group--assignment-questions"),r.title=n.translations.nQuestionsCompleted,i.appendChild(r);var d=document.createElement("span");d.textContent=t.results.nSecondAnswered,r.appendChild(d);var l=document.createElement("span");l.textContent="/",r.appendChild(l);var u=document.createElement("span");u.textContent=t.results.n,r.appendChild(u);var c=document.createElement("span");c.classList.add("student-group--assignment-title"),c.title=n.translations.goToAssignment,c.textContent=t.title,i.appendChild(c);var p=document.createElement("span");if(p.classList.add("student-group--assignment-date"),t.dueDate<=new Date(Date.now()))p.title=n.translations.assignmentExpired,p.textContent=n.translations.expired;else{p.title=n.translations.dueOn+" "+t.dueDate.toLocaleString("en-ca",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"});var m=document.createElement("i");m.classList.add("material-icons","md-18"),m.textContent="access_time",p.appendChild(m);var g=document.createElement("span");g.textContent=function(t,e){var i=t-e,s=Math.floor(i/1e3/60/60/24);i-=24*s*60*60*1e3;var o=Math.floor(i/1e3/60/60);i-=60*o*60*1e3;var a=Math.floor(i/1e3/60),r="";return s>1?r=r+parseInt(s)+" "+n.translations.days+", ":1===s&&(r=r+parseInt(s)+" "+n.translations.day+", "),1===o?r=r+parseInt(o)+" "+n.translations.hour+", ":(o>1||s)&&(r=r+parseInt(o)+" "+n.translations.hours+", "),r=1===a?r+parseInt(a)+" "+n.translations.minute:r+parseInt(a)+" "+n.translations.minutes}(t.dueDate,new Date(Date.now())),p.appendChild(g),s<=new Date(Date.now())&&m.classList.add("blinking")}return i.appendChild(p),e}(t))}),e.appendChild(i)}else{var s=document.createElement("span");s.classList.add("student-group--no-assignments"),s.textContent=n.translations.noAssignments,e.appendChild(s)}return e}(t)),i}(i))})}function r(t,e){var n=e.querySelector(".student-group--id__id"),i=e.querySelector(".student-group--id__input"),s=e.querySelector(".student-group--id__copy"),o=e.querySelector(".student-group--id__edit"),a=e.querySelector(".student-group--id__confirm"),r=e.querySelector(".student-group--id__cancel");i.value=t.studentId,n.style.display="none",s.style.display="none",o.style.display="none",i.style.display="inline-block",a.style.display="flex",r.style.display="flex",i.focus()}function d(t,e){var n=e.querySelector("span"),i=e.querySelector("input"),s=e.querySelector(".student-group--id__copy"),o=e.querySelector(".student-group--id__edit"),a=e.querySelector(".student-group--id__confirm"),r=e.querySelector(".student-group--id__cancel");n.textContent=t.studentId,n.style.display="inline-block",s.style.display="flex",o.style.display="flex",i.style.display="none",a.style.display="none",r.style.display="none"}function l(t){var e=t.querySelector(".student-group--remove-confirmation-box");"none"==e.style.display?e.style.display="flex":e.style.display="none"}function u(t,i){var s=n.urls.saveStudentId,o=e({student_id:i.querySelector("input").value,group_name:t.name},"post");fetch(s,o).then(function(t){return t.json()}).then(function(e){t.studentId=e.student_id,d(t,i)}).catch(function(e){d(t,i),console.log(e)})}function c(){n.joiningGroup=!n.joiningGroup,o()}function p(){var t=n.urls.joinGroup,i=document.querySelector("#student-add-group--box input"),s=document.querySelector("#student-add-group--box select"),o=void 0;i.value?o={username:n.student.username,group_link:i.value}:n.groups.some(function(t){return!t.memberOf})?o={username:n.student.username,group_name:s.value}:console.log("Empty input");var r=e(o,"post");fetch(t,r).then(function(t){return t.json()}).then(function(t){i.value="",n.groups.some(function(e){return e.name===t.name})?n.groups.filter(function(e){return e.name===t.name})[0].memberOf=t.member_of:n.groups.push({name:t.name,title:t.title,notifications:t.notifications,memberOf:t.member_of,assignments:t.assignments.map(function(t){return{title:t.title,dueDate:new Date(t.due_date),link:t.link,results:{n:t.results.n,nFirstAnswered:t.results.nFirstAnswered,nSecondAnswered:t.results.nSecondAnswered,nFirstCorrect:t.results.nFirstCorrect,nSecondCorrect:t.results.nSecondCorrect},done:t.done,almostExpired:t.almost_expired}}),studentId:t.student_id,studentIdNeeded:t.student_id_needed}),c(),a()}).catch(function(t){console.log(t)})}function m(t){for(;t.hasChildNodes();)t.removeChild(t.lastChild)}return t.joinGroup=p,t.initStudentPage=function(t){!function(t){n={expiryBlinkingDelay:t.expiry_blinking_delay,joiningGroup:!1,newStudent:t.new_student,student:{username:t.student.username,email:t.student.email,memberSince:new Date(t.student.member_since),tos:{sharing:t.student.tos.sharing,signedOn:new Date(t.student.tos.signed_on)}},groups:t.groups.map(function(t){return{name:t.name,title:t.title,notifications:t.notifications,memberOf:t.member_of,assignments:t.assignments.map(function(t){return{title:t.title,dueDate:new Date(t.due_date),link:t.link,results:{n:t.results.n,nFirstAnswered:t.results.n_first_answered,nSecondAnswered:t.results.n_second_answered,nFirstCorrect:t.results.n_first_correct,nSecondCorrect:t.results.n_second_correct},done:t.done,almostExpired:t.almost_expired}}),studentId:t.student_id,studentIdNeeded:t.student_id_needed}}),notifications:t.notifications.map(function(t){return{pk:t.pk,link:t.link,icon:t.icon,text:t.text,hoverText:t.hover_text}}),urls:{tosModify:t.urls.tos_modify,removeNotification:t.urls.remove_notification,joinGroup:t.urls.join_group,leaveGroup:t.urls.leave_group,saveStudentId:t.urls.save_student_id,studentToggleGroupnotifications:t.urls.student_toggle_group_notifications},translations:{assignmentAboutToExpire:t.translations.assignment_about_to_expire,assignmentExpired:t.translations.assignment_expired,cancel:t.translations.cancel,day:t.translations.day,days:t.translations.days,dueOn:t.translations.due_on,expired:t.translations.expired,goToAssignment:t.translations.go_to_assignment,hour:t.translations.hour,hours:t.translations.hours,leave:t.translations.leave,leaveGroupQuestion:t.translations.leave_group_question,leaveGroupText:t.translations.leave_group_text,leaveGroupTitle:t.translations.leave_group_title,minute:t.translations.minute,minutes:t.translations.minutes,nQuestionsCompleted:t.translations.n_questions_completed,noAssignments:t.translations.no_assignments,notificationsBell:t.translations.notifications_bell,notSharing:t.translations.not_sharing,sharing:t.translations.sharing,studentId:t.translations.student_id}}}(t),i()},t.modifyTos=function(){var t=n.urls.tosModify+"?next="+window.location.href;window.location.href=t},t.toggleJoinGroup=c,t.handleJoinGroupLinkInput=function(t){var e,n;"Enter"===t.key?p():(e=document.querySelector("#student-add-group--box input"),n=document.querySelector("#student-add-group--box select"),e.value?n.disabled=!0:n.disabled=!1)},t}({});

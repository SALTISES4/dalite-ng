var student=function(t){"use strict";function e(){var t="csrftoken";return document.cookie&&""!==document.cookie?document.cookie.split(";").map(function(t){return t.replace(/^\s+/,"").replace(/\s+$/,"")}).filter(function(e){return e.substring(0,t.length+1)===t+"="}).map(function(e){return decodeURIComponent(e.substring(t.length+1))})[0]:null}function n(t,n){if("get"===n.toLowerCase())return{method:n.toUpperCase(),headers:{"Content-Type":"application/json","X-CSRFToken":e()}};if("post"===n.toLowerCase()){var i=t?JSON.stringify(t):"";return{method:n.toUpperCase(),body:i,headers:{"Content-Type":"application/json","X-CSRFToken":e()}}}throw Error("Method "+n+" not implemented yet.")}function i(t){for(;t.hasChildNodes();)t.removeChild(t.lastChild)}var o=void 0;function s(){!function(){document.getElementById("student-email").textContent=o.student.email,document.getElementById("student-member-since").textContent=o.student.memberSince.toLocaleString("en-ca",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"});var t=document.getElementById("student-tos-sharing--icon"),e=document.getElementById("student-tos-sharing--sharing");o.student.tos.sharing?(t.textContent="check",e.textContent=o.translations.sharing):(t.textContent="clear",e.textContent=o.translations.notSharing);document.getElementById("student-tos-signed-on").textContent=o.student.tos.signedOn.toLocaleString("en-ca",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}(),r(),a()}function a(){var t=document.getElementById("student-add-group--box");o.joiningGroup?(!function(){var t=document.getElementById("student-old-groups");i(t);var e=o.groups.filter(function(t){return!t.memberOf});e.length?(e.map(function(e){return t.appendChild(function(t){var e=document.createElement("option");return e.value=t.name,e.textContent=t.title,e}(e))}),t.style.display="inline-block"):t.style.display="none"}(),t.style.display="flex"):t.style.display="none"}function r(){var t=document.getElementById("student-groups");i(t),o.groups.filter(function(t){return t.memberOf}).map(function(e){return t.appendChild(function(t){var e=document.createElement("div");return e.classList.add("student-group"),e.appendChild(function(t){var e=document.createElement("div");e.classList.add("student-group--title"),t.studentIdNeeded&&e.appendChild(function(t){var e=document.createElement("div");e.classList.add("student-group--id");var n=document.createElement("i");n.classList.add("material-icons","md-28","student-group--id__copy"),n.style.display="flex",n.textContent="file_copy",n.addEventListener("click",function(){return function(t,e){navigator.clipboard.writeText(t.studentId).then(function(){return function(t){var e=document.createElement("div");e.classList.add("bubble"),e.textContent="Copied to clipboard!",t.appendChild(e),setTimeout(function(){return t.removeChild(e)},600)}(e)})}(t,e)}),e.appendChild(n);var i=document.createElement("span");i.classList.add("student-group--id__id"),i.style.display="inline-block",i.textContent=t.studentId,i.title=o.translations.studentId,i.addEventListener("click",function(){return d(t,e)}),e.appendChild(i);var s=document.createElement("input");s.classList.add("student-group--id__input"),s.value=t.schoolId,s.style.display="none",s.addEventListener("keydown",function(n){return function(t,e,n){"Enter"===t?c(e,n):"Escape"===t&&u(e,n)}(n.key,t,e)}),e.appendChild(s);var a=document.createElement("i");a.classList.add("material-icons","md-28","student-group--id__edit"),a.style.display="flex",a.textContent="edit",a.addEventListener("click",function(){return d(t,e)}),e.appendChild(a);var r=document.createElement("i");r.classList.add("material-icons","md-28","student-group--id__confirm"),r.style.display="none",r.textContent="check",r.addEventListener("click",function(){return c(t,e)}),e.appendChild(r);var l=document.createElement("i");return l.classList.add("material-icons","md-28","student-group--id__cancel"),l.style.display="none",l.textContent="close",l.addEventListener("click",function(){return u(t,e)}),e.appendChild(l),e}(t));var i=document.createElement("h3");i.textContent=t.title,e.appendChild(i);var s=document.createElement("div");s.classList.add("student-group--icons"),e.appendChild(s);var a=document.createElement("div");a.classList.add("student-group--notifications"),s.appendChild(a);var p=document.createElement("i");return p.classList.add("material-icons","md-28"),p.title=o.translations.notificationsBell,p.addEventListener("click",function(){return function(t,e){var i=o.urls.studentToggleGroupnotifications,s=n({group_name:t.name},"post");fetch(i,s).then(function(t){return t.json()}).then(function(n){t.notifications=n.notifications,t.notifications?(e.textContent="notifications",e.classList.remove("student-group--notifications__disabled")):(e.textContent="notifications_off",e.classList.add("student-group--notifications__disabled"))}).catch(function(t){console.log(t)})}(t,p)}),t.notifications?p.textContent="notifications":(p.textContent="notifications_off",p.classList.add("student-group--notifications__disabled")),a.appendChild(p),s.appendChild(function(t,e){var i=document.createElement("div");i.classList.add("student-group--remove"),i.title=o.translations.leaveGroupTitle;var s=document.createElement("i");s.classList.add("material-icons","md-28"),s.addEventListener("click",function(){return l(e)}),s.textContent="remove_circle_outline",i.appendChild(s);var a=document.createElement("div");a.classList.add("student-group--remove-confirmation-box"),a.style.display="none",a.addEventListener("click",function(t){t.stopPropagation,l(e)}),i.appendChild(a);var d=document.createElement("div");d.addEventListener("click",function(t){return t.stopPropagation()}),a.appendChild(d);var u=document.createElement("h3");u.textContent=o.translations.leaveGroupTitle+" "+t.title,d.appendChild(u);var c=document.createElement("p");c.textContent=o.translations.leaveGroupText,d.appendChild(c);var p=document.createElement("p");p.textContent=o.translations.leaveGroupQuestion,d.appendChild(p);var m=document.createElement("button");m.classList.add("mdc-button","mdc-button--unelevated"),m.addEventListener("click",function(){return function(t,e){var i=o.urls.leaveGroup,s=n({group_name:t.name},"post");fetch(i,s).then(function(e){e.ok?(o.groups.filter(function(e){return e.name===t.name})[0].memberOf=!1,r()):console.log(e)}).catch(function(t){return console.log(t)})}(t)}),m.textContent=o.translations.leave,d.appendChild(m);var f=document.createElement("button");return f.classList.add("mdc-button"),f.addEventListener("click",function(){return l(e)}),f.textContent=o.translations.cancel,d.appendChild(f),i}(t,e)),e}(t)),e.appendChild(function(t){var e=document.createElement("div");if(e.classList.add("student-group--assignments"),t.assignments.length){var n=document.createElement("ul");t.assignments.map(function(t){return n.appendChild(function(t){var e=document.createElement("a");e.href=t.link;var n=document.createElement("li");n.classList.add("student-group--assignment"),t.results.nSecondAnswered==t.results.n&&n.classList.add("student-group--assignment-complete"),e.appendChild(n);var i=new Date(t.dueDate);i.setDate(i.getDate()-o.expiryBlinkingDelay);var s=document.createElement("span");s.classList.add("student-group--assignment-icon"),n.appendChild(s);var a=document.createElement("i");a.classList.add("material-icons","md-28"),t.results.nSecondAnswered==t.results.n?(s.title=o.translations.goToAssignment,a.textContent="assignment_turned_in"):t.dueDate<=new Date(Date.now())?(s.title=o.translations.assignmentExpired,a.textContent="assignment_late"):i<=new Date(Date.now())?(s.title=o.translations.assignmentAboutToExpire,a.textContent="assignment_late"):(s.title=o.translations.goToAssignment,a.textContent="assignment"),s.appendChild(a);var r=document.createElement("span");r.classList.add("student-group--assignment-questions"),r.title=o.translations.grade,n.appendChild(r);var d=document.createElement("span");d.textContent=t.results.grade,r.appendChild(d);var u=document.createElement("span");u.textContent="/",r.appendChild(u);var l=document.createElement("span");l.textContent=t.results.n,r.appendChild(l);var c=document.createElement("span");c.classList.add("student-group--assignment-title"),c.title=o.translations.goToAssignment,c.textContent=t.title,n.appendChild(c);var p=document.createElement("span");if(p.classList.add("student-group--assignment-date"),t.dueDate<=new Date(Date.now()))p.title=o.translations.assignmentExpired,p.textContent=o.translations.expired;else{p.title=o.translations.dueOn+" "+t.dueDate.toLocaleString("en-ca",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"});var m=document.createElement("i");m.classList.add("material-icons","md-18"),m.textContent="access_time",p.appendChild(m);var f=document.createElement("span");f.textContent=function(t,e){var n=t-e,i=Math.floor(n/1e3/60/60/24);n-=24*i*60*60*1e3;var s=Math.floor(n/1e3/60/60);n-=60*s*60*1e3;var a=Math.floor(n/1e3/60),r="";return i>1?r=r+parseInt(i)+" "+o.translations.days+", ":1===i&&(r=r+parseInt(i)+" "+o.translations.day+", "),1===s?r=r+parseInt(s)+" "+o.translations.hour+", ":(s>1||i)&&(r=r+parseInt(s)+" "+o.translations.hours+", "),r=1===a?r+parseInt(a)+" "+o.translations.minute:r+parseInt(a)+" "+o.translations.minutes}(t.dueDate,new Date(Date.now())),p.appendChild(f),i<=new Date(Date.now())&&m.classList.add("blinking")}return n.appendChild(p),e}(t))}),e.appendChild(n)}else{var i=document.createElement("span");i.classList.add("student-group--no-assignments"),i.textContent=o.translations.noAssignments,e.appendChild(i)}return e}(t)),e}(e))})}function d(t,e){var n=e.querySelector(".student-group--id__id"),i=e.querySelector(".student-group--id__input"),o=e.querySelector(".student-group--id__copy"),s=e.querySelector(".student-group--id__edit"),a=e.querySelector(".student-group--id__confirm"),r=e.querySelector(".student-group--id__cancel");i.value=t.studentId,n.style.display="none",o.style.display="none",s.style.display="none",i.style.display="inline-block",a.style.display="flex",r.style.display="flex",i.focus()}function u(t,e){var n=e.querySelector("span"),i=e.querySelector("input"),o=e.querySelector(".student-group--id__copy"),s=e.querySelector(".student-group--id__edit"),a=e.querySelector(".student-group--id__confirm"),r=e.querySelector(".student-group--id__cancel");n.textContent=t.studentId,n.style.display="inline-block",o.style.display="flex",s.style.display="flex",i.style.display="none",a.style.display="none",r.style.display="none"}function l(t){var e=t.querySelector(".student-group--remove-confirmation-box");"none"==e.style.display?e.style.display="flex":e.style.display="none"}function c(t,e){var i=o.urls.saveStudentId,s=n({student_id:e.querySelector("input").value,group_name:t.name},"post");fetch(i,s).then(function(t){return t.json()}).then(function(n){t.studentId=n.student_id,u(t,e)}).catch(function(n){u(t,e),console.log(n)})}function p(){o.joiningGroup=!o.joiningGroup,a()}function m(){var t=o.urls.joinGroup,e=document.querySelector("#student-add-group--box input"),i=document.querySelector("#student-add-group--box select"),s=void 0;e.value?s={username:o.student.username,group_link:e.value}:o.groups.some(function(t){return!t.memberOf})?s={username:o.student.username,group_name:i.value}:console.log("Empty input");var a=n(s,"post");fetch(t,a).then(function(t){return t.json()}).then(function(t){e.value="",o.groups.some(function(e){return e.name===t.name})?o.groups.filter(function(e){return e.name===t.name})[0].memberOf=t.member_of:o.groups.push({name:t.name,title:t.title,notifications:t.notifications,memberOf:t.member_of,assignments:t.assignments.map(function(t){return{title:t.title,dueDate:new Date(t.due_date),link:t.link,results:{n:t.results.n,nFirstAnswered:t.results.nFirstAnswered,nSecondAnswered:t.results.nSecondAnswered,nFirstCorrect:t.results.nFirstCorrect,nSecondCorrect:t.results.nSecondCorrect},done:t.done,almostExpired:t.almost_expired}}),studentId:t.student_id,studentIdNeeded:t.student_id_needed}),p(),r()}).catch(function(t){console.log(t)})}var f=void 0;function g(){f.notificationsOpen=!f.notificationsOpen,h()}function v(){var t=f.urls.removeNotifications,e=n({},"post");fetch(t,e).then(function(t){t.ok&&(f.notifications=[],h())}).catch(function(t){console.log(t)})}function h(){var t,e=document.querySelector(".notifications"),o=e.querySelector(".notifications__icon__badge"),s=e.querySelector(".notifications__notifications");f.notifications.length?(o.textContent=f.notifications.length,o.style.display="flex"):(o.textContent="",o.style.display="none"),i(s),f.notifications.length?f.notifications.map(function(t){s.appendChild(function(t){var e=document.createElement("div");return e.classList.add("notification"),e.textContent=t.text,e.addEventListener("click",function(){return function(t){var e=f.urls.removeNotification,i=n({notification_pk:t.pk},"post");fetch(e,i).then(function(e){e.ok&&(t.link?window.location=t.link:(f.notifications.splice(f.notifications.indexOf(t),1),h()))}).catch(function(t){console.log(t)})}(t)}),e}(t))}):s.appendChild(((t=document.createElement("div")).textContent="No new notifications",t)),f.notificationsOpen?e.classList.add("notifications--open"):e.classList.remove("notifications--open")}function y(){document.querySelector(".notifications").addEventListener("click",function(t){t.stopPropagation()}),document.querySelector(".notifications__icon").addEventListener("click",function(t){g()}),document.body.addEventListener("click",function(t){f.notificationsOpen&&g()}),document.querySelector(".notifications__read-all-btn").addEventListener("click",v)}return t.joinGroup=m,t.initStudentPage=function(t){!function(t){o={expiryBlinkingDelay:t.expiry_blinking_delay,joiningGroup:!1,newStudent:t.new_student,student:{username:t.student.username,email:t.student.email,memberSince:new Date(t.student.member_since),tos:{sharing:t.student.tos.sharing,signedOn:new Date(t.student.tos.signed_on)}},groups:t.groups.map(function(t){return{name:t.name,title:t.title,notifications:t.notifications,memberOf:t.member_of,assignments:t.assignments.map(function(t){return{title:t.title,dueDate:new Date(t.due_date),link:t.link,results:{grade:t.results.grade,n:t.results.n},done:t.done,almostExpired:t.almost_expired}}),studentId:t.student_id,studentIdNeeded:t.student_id_needed}}),urls:{tosModify:t.urls.tos_modify,joinGroup:t.urls.join_group,leaveGroup:t.urls.leave_group,saveStudentId:t.urls.save_student_id,studentToggleGroupnotifications:t.urls.student_toggle_group_notifications},translations:{assignmentAboutToExpire:t.translations.assignment_about_to_expire,assignmentExpired:t.translations.assignment_expired,cancel:t.translations.cancel,day:t.translations.day,days:t.translations.days,dueOn:t.translations.due_on,expired:t.translations.expired,goToAssignment:t.translations.go_to_assignment,grade:t.translations.grade,hour:t.translations.hour,hours:t.translations.hours,leave:t.translations.leave,leaveGroupQuestion:t.translations.leave_group_question,leaveGroupText:t.translations.leave_group_text,leaveGroupTitle:t.translations.leave_group_title,minute:t.translations.minute,minutes:t.translations.minutes,noAssignments:t.translations.no_assignments,notificationsBell:t.translations.notifications_bell,notSharing:t.translations.not_sharing,sharing:t.translations.sharing,studentId:t.translations.student_id}}}(t),s()},t.modifyTos=function(){var t=o.urls.tosModify+"?next="+window.location.href;window.location.href=t},t.toggleJoinGroup=p,t.handleJoinGroupLinkInput=function(t){var e,n;"Enter"===t.key?m():(e=document.querySelector("#student-add-group--box input"),n=document.querySelector("#student-add-group--box select"),e.value?n.disabled=!0:n.disabled=!1)},t.initStudentHeader=function(t){var e=n(null,"get");fetch(t,e).then(function(t){return t.json()}).then(function(t){!function(t){f={notificationsOpen:!1,notifications:t.notifications,urls:{removeNotification:t.urls.remove_notification,removeNotifications:t.urls.remove_notifications}}}(t),y(),h()}).catch(function(t){return console.log(t)})},t}({});

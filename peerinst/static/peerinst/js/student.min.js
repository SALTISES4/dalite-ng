var student=function(t){"use strict";function e(){var t="csrftoken";return document.cookie&&""!==document.cookie?document.cookie.split(";").filter(function(e){return e.replace(/^\s+/,"").replace(/\s*$/,"").substring(0,t.length+1)===t+"="}).map(function(e){return decodeURIComponent(e.substring(t.length+1)).replace(/^=/,"")})[0]:null}function n(t,n){return console.log(e()),{method:n.toUpperCase(),body:JSON.stringify(t),headers:{"Content-Type":"application/json","X-CSRFToken":e()}}}var i=void 0;function s(){!function(){document.getElementById("student-email").textContent=i.student.email,document.getElementById("student-member-since").textContent=i.student.memberSince.toLocaleString("en-ca",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"});var t=document.getElementById("student-tos-sharing--icon"),e=document.getElementById("student-tos-sharing--sharing");i.student.tos.sharing?(t.textContent="check",e.textContent=i.translations.sharing):(t.textContent="clear",e.textContent=i.translations.notSharing);document.getElementById("student-tos-signed-on").textContent=i.student.tos.signedOn.toLocaleString("en-ca",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}(),o(),r(),a()}function o(){var t=document.getElementById("notifications");if(i.notifications.length){var e=t.querySelector("ul");i.notifications.map(function(t){return e.appendChild(function(t){var e=document.createElement("a");e.title=t.hoverText,e.addEventListener("click",function(){return function(t){var e=i.urls.removeNotification,s=n({notification_pk:t.pk},"post");fetch(e,s).then(function(e){e.ok?t.link?window.location=t.link:(i.notifications.splice(i.notifications.indexOf(t),1),o()):console.log(e)}).catch(function(t){return console.log(t)})}(t)});var s=document.createElement("li");s.classList.add("mdc-list-item"),e.appendChild(s);var a=document.createElement("span");a.classList.add("mdc-list-item__graphic","mdc-theme--primary"),s.appendChild(a);var r=document.createElement("i");r.classList.add("material-icons","md-36"),r.textContent=t.icon,a.appendChild(r);var d=document.createElement("span");return d.classList.add("mdc-list-item__text"),d.textContent=t.text,s.appendChild(d),e}(t))}),t.style.display="block"}else t.style.display="none"}function a(){var t=document.getElementById("student-add-group--box");i.joiningGroup?(!function(){var t=document.getElementById("student-old-groups");g(t);var e=i.groups.filter(function(t){return!t.memberOf});e.length?(e.map(function(e){return t.appendChild(function(t){var e=document.createElement("option");return e.value=t.name,e.textContent=t.title,e}(e))}),t.style.display="inline-block"):t.style.display="none"}(),t.style.display="flex"):t.style.display="none"}function r(){var t=document.getElementById("student-groups");g(t),i.groups.filter(function(t){return t.memberOf}).map(function(e){return t.appendChild(function(t){var e=document.createElement("div");return e.classList.add("student-group"),e.appendChild(function(t){var e=document.createElement("div");e.classList.add("student-group--title"),console.log(t.studentIdNeeded),t.studentIdNeeded&&e.appendChild(function(t){var e=document.createElement("div");e.classList.add("student-group--id");var n=document.createElement("i");n.classList.add("material-icons","md-28","student-group--id__copy"),n.style.display="flex",n.textContent="file_copy",n.addEventListener("click",function(){return function(t,e){navigator.clipboard.writeText(t.studentId).then(function(){return function(t){var e=document.createElement("div");e.classList.add("bubble"),e.textContent="Copied to clipboard!",t.appendChild(e),setTimeout(function(){return t.removeChild(e)},600)}(e)})}(t,e)}),e.appendChild(n);var s=document.createElement("span");s.classList.add("student-group--id__id"),s.style.display="inline-block",s.textContent=t.studentId,s.title=i.translations.studentId,s.addEventListener("click",function(){return d(t,e)}),e.appendChild(s);var o=document.createElement("input");o.classList.add("student-group--id__input"),o.value=t.schoolId,o.style.display="none",o.addEventListener("keydown",function(n){return function(t,e,n){"Enter"===t?c(e,n):"Escape"===t&&l(e,n)}(n.key,t,e)}),e.appendChild(o);var a=document.createElement("i");a.classList.add("material-icons","md-28","student-group--id__edit"),a.style.display="flex",a.textContent="edit",a.addEventListener("click",function(){return d(t,e)}),e.appendChild(a);var r=document.createElement("i");r.classList.add("material-icons","md-28","student-group--id__confirm"),r.style.display="none",r.textContent="check",r.addEventListener("click",function(){return c(t,e)}),e.appendChild(r);var u=document.createElement("i");return u.classList.add("material-icons","md-28","student-group--id__cancel"),u.style.display="none",u.textContent="close",u.addEventListener("click",function(){return l(t,e)}),e.appendChild(u),e}(t));var s=document.createElement("h3");s.textContent=t.title,e.appendChild(s);var o=document.createElement("div");o.classList.add("student-group--icons"),e.appendChild(o);var a=document.createElement("div");a.classList.add("student-group--notifications"),o.appendChild(a);var p=document.createElement("i");return p.classList.add("material-icons","md-28"),p.title=i.translations.notificationsBell,p.addEventListener("click",function(){return function(t,e){var s=i.urls.studentToggleGroupnotifications,o=n({group_name:t.name},"post");fetch(s,o).then(function(t){return t.json()}).then(function(n){t.notifications=n.notifications,t.notifications?(e.textContent="notifications",e.classList.remove("student-group--notifications__disabled")):(e.textContent="notifications_off",e.classList.add("student-group--notifications__disabled"))}).catch(function(t){console.log(t)})}(t,p)}),t.notifications?p.textContent="notifications":(p.textContent="notifications_off",p.classList.add("student-group--notifications__disabled")),a.appendChild(p),o.appendChild(function(t,e){var s=document.createElement("div");s.classList.add("student-group--remove"),s.title=i.translations.leaveGroupTitle;var o=document.createElement("i");o.classList.add("material-icons","md-28"),o.addEventListener("click",function(){return u(e)}),o.textContent="remove_circle_outline",s.appendChild(o);var a=document.createElement("div");a.classList.add("student-group--remove-confirmation-box"),a.style.display="none",a.addEventListener("click",function(t){t.stopPropagation,u(e)}),s.appendChild(a);var d=document.createElement("div");d.addEventListener("click",function(t){return t.stopPropagation()}),a.appendChild(d);var l=document.createElement("h3");l.textContent=i.translations.leaveGroupTitle+" "+t.title,d.appendChild(l);var c=document.createElement("p");c.textContent=i.translations.leaveGroupText,d.appendChild(c);var p=document.createElement("p");p.textContent=i.translations.leaveGroupQuestion,d.appendChild(p);var m=document.createElement("button");m.classList.add("mdc-button","mdc-button--unelevated"),m.addEventListener("click",function(){return function(t,e){var s=i.urls.leaveGroup,o=n({group_name:t.name},"post");fetch(s,o).then(function(e){e.ok?(i.groups.filter(function(e){return e.name===t.name})[0].memberOf=!1,r()):console.log(e)}).catch(function(t){return console.log(t)})}(t)}),m.textContent=i.translations.leave,d.appendChild(m);var g=document.createElement("button");return g.classList.add("mdc-button"),g.addEventListener("click",function(){return u(e)}),g.textContent=i.translations.cancel,d.appendChild(g),s}(t,e)),e}(t)),e.appendChild(function(t){var e=document.createElement("div");if(e.classList.add("student-group--assignments"),t.assignments.length){var n=document.createElement("ul");t.assignments.map(function(t){return n.appendChild(function(t){var e=document.createElement("a");e.href=t.link;var n=document.createElement("li");n.classList.add("student-group--assignment"),t.results.nSecondAnswered==t.results.n&&n.classList.add("student-group--assignment-complete"),e.appendChild(n);var s=new Date(t.dueDate);s.setDate(s.getDate()-i.expiryBlinkingDelay);var o=document.createElement("span");o.classList.add("student-group--assignment-icon"),n.appendChild(o);var a=document.createElement("i");a.classList.add("material-icons","md-28"),t.results.nSecondAnswered==t.results.n?(o.title=i.translations.goToAssignment,a.textContent="assignment_turned_in"):t.dueDate<=new Date(Date.now())?(o.title=i.translations.assignmentExpired,a.textContent="assignment_late"):s<=new Date(Date.now())?(o.title=i.translations.assignmentaboutToExpire,a.textContent="assignment_late"):(o.title=i.translations.goToAssignment,a.textContent="assignment"),o.appendChild(a);var r=document.createElement("span");r.classList.add("student-group--assignment-questions"),r.title=i.translations.nQuestionsCompleted,n.appendChild(r);var d=document.createElement("span");d.textContent=t.results.nSecondAnswered,r.appendChild(d);var l=document.createElement("span");l.textContent="/",r.appendChild(l);var u=document.createElement("span");u.textContent=t.results.n,r.appendChild(u);var c=document.createElement("span");c.classList.add("student-group--assignment-title"),c.title=i.translations.goToAssignment,c.textContent=t.title,n.appendChild(c);var p=document.createElement("span");if(p.classList.add("student-group--assignment-date"),t.dueDate<=new Date(Date.now()))p.title=i.translations.assignmentExpired,p.textContent=i.translations.expired;else{p.title=i.translations.dueOn+" "+t.dueDate.toLocaleString("en-ca",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"});var m=document.createElement("i");m.classList.add("material-icons","md-18"),m.textContent="access_time",p.appendChild(m);var g=document.createElement("span");g.textContent=function(t,e){var n=t-e,s=Math.floor(n/1e3/60/60/24);n-=24*s*60*60*1e3;var o=Math.floor(n/1e3/60/60);n-=60*o*60*1e3;var a=Math.floor(n/1e3/60),r="";return s>1?r=r+parseInt(s)+" "+i.translations.days+", ":1===s&&(r=r+parseInt(s)+" "+i.translations.day+", "),1===o?r=r+parseInt(o)+" "+i.translations.hour+", ":(o>1||s)&&(r=r+parseInt(o)+" "+i.translations.hours+", "),r=1===a?r+parseInt(a)+" "+i.translations.minute:r+parseInt(a)+" "+i.translations.minutes}(t.dueDate,new Date(Date.now())),p.appendChild(g),s<=new Date(Date.now())&&m.classList.add("blinking")}return n.appendChild(p),e}(t))}),e.appendChild(n)}else{var s=document.createElement("span");s.classList.add("student-group--no-assignments"),s.textContent=i.translations.noAssignments,e.appendChild(s)}return e}(t)),e}(e))})}function d(t,e){var n=e.querySelector(".student-group--id__id"),i=e.querySelector(".student-group--id__input"),s=e.querySelector(".student-group--id__copy"),o=e.querySelector(".student-group--id__edit"),a=e.querySelector(".student-group--id__confirm"),r=e.querySelector(".student-group--id__cancel");i.value=t.studentId,n.style.display="none",s.style.display="none",o.style.display="none",i.style.display="inline-block",a.style.display="flex",r.style.display="flex",i.focus()}function l(t,e){var n=e.querySelector("span"),i=e.querySelector("input"),s=e.querySelector(".student-group--id__copy"),o=e.querySelector(".student-group--id__edit"),a=e.querySelector(".student-group--id__confirm"),r=e.querySelector(".student-group--id__cancel");n.textContent=t.studentId,n.style.display="inline-block",s.style.display="flex",o.style.display="flex",i.style.display="none",a.style.display="none",r.style.display="none"}function u(t){var e=t.querySelector(".student-group--remove-confirmation-box");"none"==e.style.display?e.style.display="flex":e.style.display="none"}function c(t,e){var s=i.urls.saveStudentId,o=n({student_id:e.querySelector("input").value,group_name:t.name},"post");fetch(s,o).then(function(t){return t.json()}).then(function(n){t.studentId=n.student_id,l(t,e)}).catch(function(n){l(t,e),console.log(n)})}function p(){i.joiningGroup=!i.joiningGroup,a()}function m(){var t=i.urls.joinGroup,e=document.querySelector("#student-add-group--box input"),s=document.querySelector("#student-add-group--box select"),o=void 0;e.value?o={username:i.student.username,group_link:e.value}:i.groups.some(function(t){return!t.memberOf})?o={username:i.student.username,group_name:s.value}:console.log("Empty input");var a=n(o,"post");fetch(t,a).then(function(t){return t.json()}).then(function(t){e.value="",i.groups.some(function(e){return e.name===t.name})?i.groups.filter(function(e){return e.name===t.name})[0].memberOf=t.member_of:i.groups.push({name:t.name,title:t.title,notifications:t.notifications,memberOf:t.member_of,assignments:t.assignments.map(function(t){return{title:t.title,dueDate:new Date(t.due_date),link:t.link,results:{n:t.results.n,nFirstAnswered:t.results.nFirstAnswered,nSecondAnswered:t.results.nSecondAnswered,nFirstCorrect:t.results.nFirstCorrect,nSecondCorrect:t.results.nSecondCorrect},done:t.done,almostExpired:t.almost_expired}}),studentId:t.student_id,studentIdNeeded:t.student_id_needed}),p(),r()}).catch(function(t){console.log(t)})}function g(t){for(;t.hasChildNodes();)t.removeChild(t.lastChild)}return t.joinGroup=m,t.initStudentPage=function(t){!function(t){i={expiryBlinkingDelay:t.expiry_blinking_delay,joiningGroup:!1,newStudent:t.new_student,student:{username:t.student.username,email:t.student.email,memberSince:new Date(t.student.member_since),tos:{sharing:t.student.tos.sharing,signedOn:new Date(t.student.tos.signed_on)}},groups:t.groups.map(function(t){return{name:t.name,title:t.title,notifications:t.notifications,memberOf:t.member_of,assignments:t.assignments.map(function(t){return{title:t.title,dueDate:new Date(t.due_date),link:t.link,results:{n:t.results.n,nFirstAnswered:t.results.n_first_answered,nSecondAnswered:t.results.n_second_answered,nFirstCorrect:t.results.n_first_correct,nSecondCorrect:t.results.n_second_correct},done:t.done,almostExpired:t.almost_expired}}),studentId:t.student_id,studentIdNeeded:t.student_id_needed}}),notifications:t.notifications.map(function(t){return{pk:t.pk,link:t.link,icon:t.icon,text:t.text,hoverText:t.hover_text}}),urls:{tosModify:t.urls.tos_modify,removeNotification:t.urls.remove_notification,joinGroup:t.urls.join_group,leaveGroup:t.urls.leave_group,saveStudentId:t.urls.save_student_id,studentToggleGroupnotifications:t.urls.student_toggle_group_notifications},translations:{assignmentAboutToExpire:t.translations.assignment_about_to_expire,assignmentExpired:t.translations.assignment_expired,cancel:t.translations.cancel,day:t.translations.day,days:t.translations.days,dueOn:t.translations.due_on,expired:t.translations.expired,goToAssignment:t.translations.go_to_assignment,hour:t.translations.hour,hours:t.translations.hours,leave:t.translations.leave,leaveGroupQuestion:t.translations.leave_group_question,leaveGroupText:t.translations.leave_group_text,leaveGroupTitle:t.translations.leave_group_title,minute:t.translations.minute,minutes:t.translations.minutes,nQuestionsCompleted:t.translations.n_questions_completed,noAssignments:t.translations.no_assignments,notificationsBell:t.translations.notifications_bell,notSharing:t.translations.not_sharing,sharing:t.translations.sharing,studentId:t.translations.student_id}}}(t),s()},t.modifyTos=function(){var t=i.urls.tosModify+"?next="+window.location.href;window.location.href=t},t.toggleJoinGroup=p,t.handleJoinGroupLinkInput=function(t){var e,n;"Enter"===t.key?m():(e=document.querySelector("#student-add-group--box input"),n=document.querySelector("#student-add-group--box select"),e.value?n.disabled=!0:n.disabled=!1)},t}({});

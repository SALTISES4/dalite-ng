{"version":3,"file":"question.min.js","sources":["ajax.js","_question/start.js","_question/review.js","utils.js","_question/base.js"],"sourcesContent":["\"use strict\";\n\nexport function getCsrfToken() {\n  return document\n    .getElementsByName(\"csrfmiddlewaretoken\")[0]\n    .getAttribute(\"value\");\n}\n\nexport function buildReq(data, method) {\n  if (method.toLowerCase() === \"get\") {\n    return {\n      method: method.toUpperCase(),\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"X-CSRFToken\": getCsrfToken(),\n      },\n    };\n  } else if (method.toLowerCase() === \"post\") {\n    const body = data ? JSON.stringify(data) : \"\";\n    return {\n      method: method.toUpperCase(),\n      body: body,\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"X-CSRFToken\": getCsrfToken(),\n      },\n    };\n  } else {\n    throw Error(`Method ${method} not implemented yet.`);\n  }\n}\n\nexport function updateAssignmentQuestionList(\n  url,\n  questionId,\n  assignmentIdentifier,\n) {\n  const token = getCsrfToken();\n  const data = {\n    question_id: questionId,\n    assignment_identifier: assignmentIdentifier,\n  };\n  const req = {\n    method: \"POST\",\n    body: JSON.stringify(data),\n    credentials: \"include\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"X-CSRFToken\": token,\n    },\n  };\n  fetch(url, req)\n    .then(function (resp) {\n      if (!resp.ok) {\n        console.log(resp);\n      } else {\n        // Manipulate DOM\n        const list = document.getElementById(\"question-list\");\n        const card = document.getElementById(questionId);\n        if ($.contains(list, card)) {\n          $(\"#\" + questionId).remove();\n        } else {\n          $(\"#\" + questionId)\n            .find($(\".update-questions-btn\"))\n            .html(\"delete\");\n          const q = $(\"#\" + questionId).detach();\n          q.appendTo($(\"#question-list\"));\n          $(\"#empty-assignment-list\").remove();\n          $(\".search-set\").each(function () {\n            $(this) // eslint-disable-line no-invalid-this\n              .find(\".filter-count\")\n              .empty()\n              .append($(this).find(\".mdc-card:visible\").length); // eslint-disable-line no-invalid-this,max-len\n          });\n          $(\".search-set\").each(function () {\n            $(this) // eslint-disable-line no-invalid-this\n              .find(\".filter-count-total\")\n              .empty()\n              .append($(this).find(\".mdc-card\").length); // eslint-disable-line no-invalid-this,max-len\n          });\n        }\n      }\n    })\n    .catch(function (err) {\n      console.log(err);\n    });\n}\n","import { buildReq } from \"../ajax.js\";\nimport { clear } from \"../utils.js\";\n\n/*********/\n/* model */\n/*********/\n\nlet model;\n\nfunction initModel(submitUrl, quality) {\n  model = {\n    urls: {\n      submitUrl: submitUrl,\n    },\n    quality: quality,\n  };\n}\n\n/**********/\n/* update */\n/**********/\n\nfunction validateFormSubmit(event) {\n  if (!document.getElementById(\"your-rationale\")) {\n    event.preventDefault();\n    const data = {\n      quality: model.quality,\n      rationale: document.querySelector(\"#id_rationale\").value,\n    };\n\n    const req = buildReq(data, \"post\");\n    fetch(model.urls.submitUrl, req)\n      .then((resp) => resp.json())\n      .then((failed) => {\n        if (failed.failed.length) {\n          toggleQualityError(failed.failed, failed.error_msg);\n          document.querySelector(\"#answer-form\").disabled = false;\n        } else {\n          toggleQualityError();\n          document.querySelector(\"#answer-form\").disabled = true;\n          document.querySelector(\"#submit-answer-form\").submit();\n        }\n      })\n      .catch((err) => console.log(err));\n  }\n}\n\n/********/\n/* view */\n/********/\n\nfunction toggleQualityError(data, errorMsg) {\n  if (data) {\n    const form = document.querySelector(\"#submit-answer-form\");\n\n    let div = document.querySelector(\".errorlist\");\n    if (!div) {\n      div = document.createElement(\"div\");\n    }\n    clear(div);\n\n    div.classList.add(\"errorlist\");\n    div.textContent = errorMsg;\n\n    const ul = document.createElement(\"ul\");\n    div.append(ul);\n    data.forEach((criterion) => {\n      const li = document.createElement(\"li\");\n      li.textContent = criterion.name;\n      li.title = criterion.description;\n      ul.append(li);\n    });\n\n    form.parentNode.insertBefore(div, form);\n  } else {\n    const err = document.querySelector(\"errorlist\");\n    if (err) {\n      err.parentNode.removeChild(err);\n    }\n  }\n}\n\n/*************/\n/* listeners */\n/*************/\n\nfunction initListeners() {\n  addSubmitListener();\n}\n\nfunction addSubmitListener() {\n  const input = document.getElementById(\"answer-form\");\n  if (input) {\n    input.addEventListener(\"click\", (event) => {\n      validateFormSubmit(event);\n    });\n  }\n}\n\n/********/\n/* init */\n/********/\n\nexport function init(submitUrl, quality) {\n  initModel(submitUrl, quality);\n  initListeners();\n}\n","// @flow\n\n/*********/\n/* model */\n/*********/\n\nlet model: {\n  submitAllowed: boolean,\n};\n\nfunction initModel() {\n  model = {\n    submitAllowed: false,\n  };\n}\n\n/**********/\n/* update */\n/**********/\n\nfunction startSubmitAllowedTimer(seconds: number) {\n  setInterval(allowSubmit, seconds * 1000);\n}\n\nfunction allowSubmit() {\n  model.submitAllowed = true;\n  submitButtonView();\n}\n\n/********/\n/* view */\n/********/\n\nfunction view() {\n  submitButtonView();\n}\n\nfunction submitButtonView() {\n  if (model.submitAllowed) {\n    // $FlowFixMe\n    document.getElementById(\"answer-form\").disabled = false;\n  } else {\n    // $FlowFixMe\n    document.getElementById(\"answer-form\").disabled = true;\n  }\n}\n\n/********/\n/* init */\n/********/\n\nexport function init() {\n  initModel();\n  view();\n  startSubmitAllowedTimer(5);\n}\n","// @flow\n\"use strict\";\n\nexport function clear(node: HTMLElement): HTMLElement {\n  while (node.hasChildNodes()) {\n    // $FlowFixMe\n    node.removeChild(node.lastChild);\n  }\n  return node;\n}\n\nexport function formatDatetime(datetime: Date): string {\n  return (\n    datetime.toLocaleString(\"en-ca\", { year: \"numeric\" }) +\n    \"-\" +\n    datetime.toLocaleString(\"en-ca\", { month: \"2-digit\" }) +\n    \"-\" +\n    datetime.toLocaleString(\"en-ca\", { day: \"2-digit\" }) +\n    \" \" +\n    datetime.toLocaleString(\"en-ca\", { hour: \"2-digit\", hour12: false }) +\n    \":\" +\n    datetime.toLocaleString(\"en-ca\", { minute: \"2-digit\" })\n  );\n}\n\nexport function createSvg(name: string, useSprite: boolean = true): Element {\n  const svg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n  const use = document.createElementNS(\"http://www.w3.org/2000/svg\", \"use\");\n  use.setAttributeNS(\n    \"http://www.w3.org/1999/xlink\",\n    \"href\",\n    svgLink(name, useSprite),\n  );\n  svg.append(use);\n  return svg;\n}\n\nexport function svgLink(name: string, useSprite: boolean = true): string {\n  if (useSprite) {\n    return `#${name}`;\n  } else {\n    return (\n      window.location.protocol +\n      \"//\" +\n      window.location.host +\n      \"/static/peerinst/icons.svg#\" +\n      name\n    );\n  }\n}\n\nexport function showAlert(msg: string) {\n  const fullPageBox = document.createElement(\"div\");\n  fullPageBox.classList.add(\"alert-box__full-page\");\n  fullPageBox.addEventListener(\"click\", (event: MouseEvent) => {\n    event.stopPropagation();\n    fullPageBox.parentNode?.removeChild(fullPageBox);\n  });\n  document.body?.appendChild(fullPageBox);\n\n  const box = document.createElement(\"div\");\n  box.classList.add(\"alert-box__box\");\n  box.addEventListener(\"click\", (event: MouseEvent) =>\n    event.stopPropagation(),\n  );\n  fullPageBox.appendChild(box);\n\n  const span = document.createElement(\"span\");\n  span.classList.add(\"alert-box__msg\");\n  span.textContent = msg;\n  box.appendChild(span);\n\n  const ok = document.createElement(\"button\");\n  ok.classList.add(\"alert-box__btn\", \"mdc-button\", \"mdc-button--unelevated\");\n  ok.textContent = \"Ok\";\n  box.appendChild(ok);\n}\n\nexport function createElement(tag, text = \"\", attributes = {}) {\n  const elem = document.createElement(tag);\n  if (text) {\n    elem.textContent = text;\n  }\n  Object.entries(attributes).forEach(([key, val]) => {\n    elem.setAttribute(key, val);\n  });\n  return elem;\n}\n","export function submitForm() {\n  document.querySelector(\"#submit-answer-form\").submit();\n}\n"],"names":["getCsrfToken","document","getElementsByName","getAttribute","model","validateFormSubmit","event","getElementById","preventDefault","req","data","method","toLowerCase","toUpperCase","headers","body","JSON","stringify","Error","buildReq","quality","rationale","querySelector","value","fetch","urls","submitUrl","then","resp","json","failed","length","toggleQualityError","error_msg","disabled","submit","catch","err","console","log","errorMsg","form","div","createElement","node","hasChildNodes","removeChild","lastChild","clear","classList","add","textContent","ul","append","forEach","criterion","li","name","title","description","parentNode","insertBefore","initListeners","input","addEventListener","addSubmitListener","allowSubmit","submitAllowed","submitButtonView","setInterval","initModel"],"mappings":"0BAEO,SAASA,WACPC,SACJC,kBAAkB,uBAAuB,GACzCC,aAAa,SCElB,IAAIC,ECDAA,EDgBJ,SAASC,EAAmBC,OACrBL,SAASM,eAAe,kBAAmB,CAC9CD,EAAME,uBAMAC,EDtBH,SAAkBC,EAAMC,MACA,QAAzBA,EAAOC,oBACF,CACLD,OAAQA,EAAOE,cACfC,QAAS,gBACS,iCACDd,MAGd,GAA6B,SAAzBW,EAAOC,cAA0B,OACpCG,EAAOL,EAAOM,KAAKC,UAAUP,GAAQ,SACpC,CACLC,OAAQA,EAAOE,cACfE,KAAMA,EACND,QAAS,gBACS,iCACDd,YAIbkB,uBAAgBP,4BCEVQ,CALC,CACXC,QAAShB,EAAMgB,QACfC,UAAWpB,SAASqB,cAAc,iBAAiBC,OAG1B,QAC3BC,MAAMpB,EAAMqB,KAAKC,UAAWjB,GACzBkB,KAAMC,GAASA,EAAKC,QACpBF,KAAMG,IACDA,EAAOA,OAAOC,QAChBC,EAAmBF,EAAOA,OAAQA,EAAOG,WACzChC,SAASqB,cAAc,gBAAgBY,UAAW,IAElDF,IACA/B,SAASqB,cAAc,gBAAgBY,UAAW,EAClDjC,SAASqB,cAAc,uBAAuBa,YAGjDC,MAAOC,GAAQC,QAAQC,IAAIF,KAQlC,SAASL,EAAmBtB,EAAM8B,MAC5B9B,EAAM,OACF+B,EAAOxC,SAASqB,cAAc,2BAEhCoB,EAAMzC,SAASqB,cAAc,cAC5BoB,IACHA,EAAMzC,SAAS0C,cAAc,QEtD5B,SAAeC,QACbA,EAAKC,iBAEVD,EAAKE,YAAYF,EAAKG,WFqDtBC,CAAMN,GAENA,EAAIO,UAAUC,IAAI,aAClBR,EAAIS,YAAcX,QAEZY,EAAKnD,SAAS0C,cAAc,MAClCD,EAAIW,OAAOD,GACX1C,EAAK4C,QAASC,UACNC,EAAKvD,SAAS0C,cAAc,MAClCa,EAAGL,YAAcI,EAAUE,KAC3BD,EAAGE,MAAQH,EAAUI,YACrBP,EAAGC,OAAOG,KAGZf,EAAKmB,WAAWC,aAAanB,EAAKD,OAC7B,OACCJ,EAAMpC,SAASqB,cAAc,aAC/Be,GACFA,EAAIuB,WAAWd,YAAYT,IASjC,SAASyB,KAIT,iBACQC,EAAQ9D,SAASM,eAAe,eAClCwD,GACFA,EAAMC,iBAAiB,QAAU1D,IAC/BD,EAAmBC,KAPvB2D,GC/DF,SAASC,IACP9D,EAAM+D,eAAgB,EACtBC,IAWF,SAASA,IACHhE,EAAM+D,cAERlE,SAASM,eAAe,eAAe2B,UAAW,EAGlDjC,SAASM,eAAe,eAAe2B,UAAW,eAQ/C,WAxCL9B,EAAQ,CACN+D,eAAe,GAsBjBC,IAbAC,YAAYH,EAAuB,IAiCX,gBDiDnB,SAAcxC,EAAWN,IA9FhC,SAAmBM,EAAWN,GAC5BhB,EAAQ,CACNqB,KAAM,CACJC,UAAWA,GAEbN,QAASA,GA0FXkD,CAAU5C,EAAWN,GACrB0C,kBGzGK,WACL7D,SAASqB,cAAc,uBAAuBa"}
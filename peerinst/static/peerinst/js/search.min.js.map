{"version":3,"file":"search.min.js","sources":["ajax.js","search.js"],"sourcesContent":["\"use strict\";\n\nexport function getCsrfToken() {\n  return document\n    .getElementsByName(\"csrfmiddlewaretoken\")[0]\n    .getAttribute(\"value\");\n}\n\nexport function buildReq(data, method) {\n  if (method.toLowerCase() === \"get\") {\n    return {\n      method: method.toUpperCase(),\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"X-CSRFToken\": getCsrfToken(),\n      },\n    };\n  } else if (method.toLowerCase() === \"post\") {\n    const body = data ? JSON.stringify(data) : \"\";\n    return {\n      method: method.toUpperCase(),\n      body: body,\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"X-CSRFToken\": getCsrfToken(),\n      },\n    };\n  } else {\n    throw Error(`Method ${method} not implemented yet.`);\n  }\n}\n\nexport function updateAssignmentQuestionList(\n  url,\n  questionId,\n  assignmentIdentifier,\n) {\n  const token = getCsrfToken();\n  const data = {\n    question_id: questionId,\n    assignment_identifier: assignmentIdentifier,\n  };\n  const req = {\n    method: \"POST\",\n    body: JSON.stringify(data),\n    credentials: \"include\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"X-CSRFToken\": token,\n    },\n  };\n  fetch(url, req)\n    .then(function (resp) {\n      if (!resp.ok) {\n        console.log(resp);\n      } else {\n        // Manipulate DOM\n        const list = document.getElementById(\"question-list\");\n        const card = document.getElementById(questionId);\n        if ($.contains(list, card)) {\n          $(\"#\" + questionId).remove();\n        } else {\n          $(\"#\" + questionId)\n            .find($(\".update-questions-btn\"))\n            .html(\"delete\");\n          const q = $(\"#\" + questionId).detach();\n          q.appendTo($(\"#question-list\"));\n          $(\"#empty-assignment-list\").remove();\n          $(\".search-set\").each(function () {\n            $(this) // eslint-disable-line no-invalid-this\n              .find(\".filter-count\")\n              .empty()\n              .append($(this).find(\".mdc-card:visible\").length); // eslint-disable-line no-invalid-this,max-len\n          });\n          $(\".search-set\").each(function () {\n            $(this) // eslint-disable-line no-invalid-this\n              .find(\".filter-count-total\")\n              .empty()\n              .append($(this).find(\".mdc-card\").length); // eslint-disable-line no-invalid-this,max-len\n          });\n        }\n      }\n    })\n    .catch(function (err) {\n      console.log(err);\n    });\n}\n","import { updateAssignmentQuestionList } from \"./ajax.js\";\n\n/** Recount search results\n *  @function\n */\nexport function recountResults() {\n  $(\".search-set\").each(function () {\n    $(this) // eslint-disable-line\n      .find(\".filter-count\")\n      .empty()\n      .append($(this).find(\".mdc-card:visible\").length); // eslint-disable-line\n  });\n}\n\n/** Filter search results\n *  @function\n *  @param {String} el\n */\nexport function filter(el) {\n  if ($(el).hasClass(\"mdc-chip--selected\")) {\n    $(el).removeClass(\"mdc-chip--selected\");\n  } else {\n    $(el).addClass(\"mdc-chip--selected\");\n  }\n\n  if ($(\".mdc-chip--selected\").length == 0) {\n    $(\"#reset-filters\").attr(\"disabled\", true);\n  }\n\n  $(\"#search_results .mdc-card\").css(\"display\", \"block\");\n\n  $(\"#search_results .mdc-card\").each(function () {\n    const card = this; // eslint-disable-line\n    $(\"#filter-on-category\")\n      .find(\".mdc-chip--selected\")\n      .each(function () {\n        if (\n          card\n            .getAttribute(\"category\")\n            .toLowerCase()\n            .indexOf(this.getAttribute(\"c\").toLowerCase()) < 0 // eslint-disable-line\n        ) {\n          $(card).css(\"display\", \"none\");\n          $(\"#reset-filters\").attr(\"disabled\", false);\n        }\n      });\n\n    $(\"#filter-on-discipline\")\n      .find(\".mdc-chip--selected\")\n      .each(function () {\n        if (\n          card.getAttribute(\"discipline\").slice(1, -1).toLowerCase() !=\n          this.getAttribute(\"d\").toLowerCase() // eslint-disable-line\n        ) {\n          $(card).css(\"display\", \"none\");\n          $(\"#reset-filters\").attr(\"disabled\", false);\n        }\n      });\n  });\n\n  recountResults();\n}\n\n/** Reset filters\n *  @function\n */\nexport function reset() {\n  $(\"#search_results .mdc-card\").each(function () {\n    $(this).css(\"display\", \"block\"); // eslint-disable-line\n    $(\".mdc-chip\").removeClass(\"mdc-chip--selected\");\n    $(\"#reset-filters\").attr(\"disabled\", true);\n  });\n\n  recountResults();\n}\n\n/** Process response for required filters\n *  @function\n */\nexport function processResponse() {\n  bundle.toggleImages();\n  bundle.toggleAnswers();\n\n  $(\"#search-bar\").attr(\"disabled\", false);\n  $(\"#progressbar\").addClass(\"mdc-linear-progress--closed\");\n\n  // Update template response\n  $(\".search-nav\").each(function (i, el) {\n    el.addEventListener(\"click\", function () {\n      pageNav(el.getAttribute(\"data-page\"));\n    });\n  });\n\n  $(\".update-questions-btn\").each(function (i, el) {\n    el.addEventListener(\"click\", function () {\n      updateAssignmentQuestionList(\n        el.getAttribute(\"data-url\"),\n        el.getAttribute(\"data-id\"),\n        el.getAttribute(\"data-assignment-id\"),\n      );\n    });\n  });\n\n  // Add filters based on search results\n  $(\"#filter-on-discipline\").empty();\n  $(\"#filter-on-category\").empty();\n\n  const disciplineList = [];\n  $(\"#filter-on-discipline\").append(\n    \"<div class='mdc-chip-set mdc-chip-set--filter' \" +\n      \"data-mdc-auto-init='MDCChipSet'></div>\",\n  );\n  $(\"#search_results .mdc-card\").each(function (index) {\n    const d = this.getAttribute(\"discipline\"); // eslint-disable-line\n    if (!disciplineList.includes(d) & (d.slice(1, -1) != \"None\")) {\n      disciplineList.push(d);\n    }\n  });\n  disciplineList.sort();\n  for (let i = 0; i < disciplineList.length; i++) {\n    $(\"#filter-on-discipline .mdc-chip-set\").append(\n      \"<div d=\" +\n        disciplineList[i] +\n        \" class='mdc-chip' \" +\n        \"tabindex='0' data-mdc-auto-init='MDCChip'>\" +\n        \"<div class='mdc-chip__checkmark' >\" +\n        \"<svg class='mdc-chip__checkmark-svg' viewBox='-2 -3 30 30'>\" +\n        \"<path class='mdc-chip__checkmark-path' fill='none' stroke='black'\" +\n        \"d='M1.73,12.91 8.1,19.28 22.79,4.59'/>\" +\n        \"</svg>\" +\n        \"</div>\" +\n        \"<div class='mdc-chip__text'>\" +\n        disciplineList[i].slice(1, -1) +\n        \"</div>\" +\n        \"</div>\",\n    );\n  }\n\n  $(\"#filter-on-discipline .mdc-chip\").each(function (i, el) {\n    el.addEventListener(\"click\", function () {\n      filter(el);\n    });\n  });\n\n  const categoryList = [];\n  $(\"#filter-on-category\").append(\n    \"<div class='mdc-chip-set mdc-chip-set--filter' \" +\n      \"data-mdc-auto-init='MDCChipSet'></div>\",\n  );\n  $(\"#search_results .mdc-card\").each(function () {\n    const c = this.getAttribute(\"category\"); // eslint-disable-line\n    const list = c.split(\",\");\n    $(list).each(function (i) {\n      if (!categoryList.includes(list[i].toLowerCase()) & (list[i] != \"\")) {\n        categoryList.push(list[i].toLowerCase());\n      }\n    });\n  });\n  categoryList.sort();\n  for (let i = 0; i < categoryList.length; i++) {\n    $(\"#filter-on-category .mdc-chip-set\").append(\n      \"<div c=\" +\n        categoryList[i] +\n        \" class='mdc-chip' tabindex='0' \" +\n        \"data-mdc-auto-init='MDCChip'>\" +\n        \"<div class='mdc-chip__checkmark' >\" +\n        \"<svg class='mdc-chip__checkmark-svg' viewBox='-2 -3 30 30'>\" +\n        \"<path class='mdc-chip__checkmark-path' fill='none' \" +\n        \"stroke='black'\" +\n        \"d='M1.73,12.91 8.1,19.28 22.79,4.59'/>\" +\n        \"</svg>\" +\n        \"</div>\" +\n        \"<div class='mdc-chip__text'>\" +\n        categoryList[i] +\n        \"</div>\" +\n        \"</div>\",\n    );\n  }\n  $(\"#filter-on-category .mdc-chip\").each(function (i, el) {\n    el.addEventListener(\"click\", function () {\n      filter(el);\n    });\n  });\n\n  if (\n    (disciplineList.length > 1 || categoryList.length > 1) &&\n    $(\"#search_results .mdc-card\").length > 1\n  ) {\n    $(\"#filters\").css(\"display\", \"block\");\n    window.location.href = \"#filters\";\n  } else {\n    window.location.href = \"#search_results\";\n  }\n  if (disciplineList.length > 1) {\n    $(\"#discipline-filters\").css(\"display\", \"block\");\n  }\n  if (categoryList.length > 1) {\n    $(\"#category-filters\").css(\"display\", \"block\");\n  }\n\n  [].forEach.call(document.querySelectorAll(\".mdc-chip\"), (el) => {\n    bundle.chips.MDCChip.attachTo(el);\n  });\n\n  [].forEach.call(document.querySelectorAll(\".mdc-chip-set\"), (el) => {\n    bundle.chips.MDCChipSet.attachTo(el);\n  });\n\n  [].forEach.call(document.querySelectorAll(\".mdc-icon-toggle\"), (el) => {\n    bundle.iconToggle.MDCIconToggle.attachTo(el);\n  });\n\n  [].forEach.call(\n    document.querySelectorAll(\"#search_results .mdc-card\"),\n    (el) => {\n      bundle.difficulty(el.getAttribute(\"matrix\").replace(/'/g, '\"'), el.id); // eslint-disable-line\n    },\n  );\n}\n\n/** Set up search\n *  @function\n */\nexport function setupSearch() {\n  $(\"#search_results\").empty();\n  $(\"#filters\").css(\"display\", \"none\");\n  $(\"#show-discipline-filters\").css(\"display\", \"none\");\n  $(\"#show-category-filters\").css(\"display\", \"none\");\n  $(\"#search-bar\").attr(\"disabled\", true);\n  $(\"#progressbar\").removeClass(\"mdc-linear-progress--closed\");\n  window.location.href = \"#progressbar\";\n}\n\n/** Initialize likes\n *  @function\n */\nexport function initFavourites() {\n  [].forEach.call(document.querySelectorAll(\".mdc-icon-toggle\"), (el) => {\n    bundle.iconToggle.MDCIconToggle.attachTo(el);\n  });\n}\n"],"names":["updateAssignmentQuestionList","url","questionId","assignmentIdentifier","token","document","getElementsByName","getAttribute","data","question_id","assignment_identifier","req","method","body","JSON","stringify","credentials","headers","fetch","then","resp","ok","list","getElementById","card","$","contains","remove","find","html","detach","appendTo","each","this","empty","append","length","console","log","catch","err","recountResults","filter","el","hasClass","removeClass","addClass","attr","css","toLowerCase","indexOf","slice","forEach","call","querySelectorAll","bundle","iconToggle","MDCIconToggle","attachTo","toggleImages","toggleAnswers","i","addEventListener","pageNav","disciplineList","index","d","includes","push","sort","categoryList","split","window","location","href","chips","MDCChip","MDCChipSet","difficulty","replace","id"],"mappings":"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"}